/**
 * @file timeline.js
 *
 * @brief
 * The Timeline is an interactive visualization chart to visualize events in
 * time, having a start and end date.
 * You can freely move and zoom in the timeline by dragging
 * and scrolling in the Timeline. Items are optionally dragable. The time
 * scale on the axis is adjusted automatically, and supports scales ranging
 * from milliseconds to years.
 *
 * Timeline is part of the CHAP Links library.
 *
 * Timeline is tested on Firefox 3.6, Safari 5.0, Chrome 6.0, Opera 10.6, and
 * Internet Explorer 6+.
 *
 * @license
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 *
 * Copyright (c) 2011-2012 Almende B.V.
 *
 * @author  Jos de Jong, <jos@almende.org>
 * @date    2012-10-04
 * @version 2.4.0
 */

typeof links=="undefined"&&(links={}),typeof google=="undefined"&&(google=undefined),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length;n<r;++n)e.call(t||this,this[n],n,this)}),links.Timeline=function(e){this.dom={},this.conversion={},this.eventParams={},this.groups=[],this.groupIndexes={},this.items=[],this.visibleItems=[],this.clusterFactory=new links.Timeline.ClusterFactory(this),this.currentClusters=[],this.selection=undefined,this.listeners={},this.size={actualHeight:0,axis:{characterMajorHeight:0,characterMajorWidth:0,characterMinorHeight:0,characterMinorWidth:0,height:0,labelMajorTop:0,labelMinorTop:0,line:0,lineMajorWidth:0,lineMinorHeight:0,lineMinorTop:0,lineMinorWidth:0,top:0},contentHeight:0,contentLeft:0,contentWidth:0,frameHeight:0,frameWidth:0,groupsLeft:0,groupsWidth:0,items:{top:0}},this.dom.container=e,this.options={width:"100%",height:"auto",minHeight:0,autoHeight:!0,eventMargin:10,eventMarginAxis:20,dragAreaWidth:10,min:undefined,max:undefined,intervalMin:10,intervalMax:31536e10,moveable:!0,zoomable:!0,selectable:!0,editable:!1,snapEvents:!0,groupChangeable:!0,showCurrentTime:!0,showCustomTime:!1,showMajorLabels:!0,showMinorLabels:!0,showNavigation:!1,showButtonNew:!1,groupsOnRight:!1,axisOnTop:!1,stackEvents:!0,animate:!0,animateZoom:!0,cluster:!1,style:"box"},this.clientTimeOffset=0;var t=this.dom;while(t.container.hasChildNodes())t.container.removeChild(t.container.firstChild);this.step=new links.Timeline.StepDate,this.data=[],this.firstDraw=!0,this.setVisibleChartRange(undefined,undefined,!1),this.render(),this.trigger("ready")},links.Timeline.prototype.draw=function(e,t){this.setOptions(t),this.setData(e),t&&(t.start||t.end)?this.setVisibleChartRange(t.start,t.end):this.firstDraw&&this.setVisibleChartRangeAuto(),this.firstDraw=!1},links.Timeline.prototype.setOptions=function(e){if(e){for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);e.showButtonAdd!=undefined&&(this.options.showButtonNew=e.showButtonAdd,console.log("WARNING: Option showButtonAdd is deprecated. Use showButtonNew instead")),e.scale&&e.step&&this.step.setScale(e.scale,e.step)}this.options.autoHeight=this.options.height==="auto"},links.Timeline.mapColumnIds=function(e){var t={},n=e.getNumberOfColumns(),r=!0;for(var i=0;i<n;i++){var s=e.getColumnId(i)||e.getColumnLabel(i);if(s=="start"||s=="end"||s=="content"||s=="group"||s=="className"||s=="editable")t[s]=i,r=!1}return r&&(t.start=0,t.end=1,t.content=2),t},links.Timeline.prototype.setData=function(e){this.unselectItem(),e||(e=[]),this.stackCancelAnimation(),this.clearItems(),this.data=e;var t=this.items;this.deleteGroups();if(google&&google.visualization&&e instanceof google.visualization.DataTable){var n=links.Timeline.mapColumnIds(e);for(var r=0,i=e.getNumberOfRows();r<i;r++)t.push(this.createItem({start:n.start!=undefined?e.getValue(r,n.start):undefined,end:n.end!=undefined?e.getValue(r,n.end):undefined,content:n.content!=undefined?e.getValue(r,n.content):undefined,group:n.group!=undefined?e.getValue(r,n.group):undefined,className:n.className!=undefined?e.getValue(r,n.className):undefined,editable:n.editable!=undefined?e.getValue(r,n.editable):undefined}))}else{if(!links.Timeline.isArray(e))throw"Unknown data type. DataTable or Array expected.";for(var r=0,i=e.length;r<i;r++){var s=e[r],o=this.createItem(s);t.push(o)}}this.options.cluster&&this.clusterFactory.setData(this.items),this.render({animate:!1})},links.Timeline.prototype.getData=function(){return this.data},links.Timeline.prototype.updateData=function(e,t){var n=this.data;if(google&&google.visualization&&n instanceof google.visualization.DataTable){var r=e+1-n.getNumberOfRows();r>0&&n.addRows(r);var i=links.Timeline.mapColumnIds(n);t.start&&n.setValue(e,i.start,t.start),t.end&&n.setValue(e,i.end,t.end),t.content&&n.setValue(e,i.content,t.content),t.group&&i.group!=undefined&&n.setValue(e,i.group,t.group),t.className&&i.className!=undefined&&n.setValue(e,i.className,t.className),t.editable&&i.editable!=undefined&&n.setValue(e,i.editable,t.editable)}else{if(!links.Timeline.isArray(n))throw"Cannot update data, unknown type of data";var s=n[e];s==undefined&&(s={},n[e]=s),t.start&&(s.start=t.start),t.end&&(s.end=t.end),t.content&&(s.content=t.content),t.group&&(s.group=t.group),t.className&&(s.className=t.className),t.editable!=undefined&&(s.editable=t.editable)}},links.Timeline.prototype.getItemIndex=function(e){var t=e,n=this.dom,r=n.items.frame,i=this.items,s=undefined;while(t.parentNode&&t.parentNode!==r)t=t.parentNode;if(t.parentNode===r)for(var o=0,u=i.length;o<u;o++)if(i[o].dom===t){s=o;break}return s},links.Timeline.prototype.setSize=function(e,t){e&&(this.options.width=e,this.dom.frame.style.width=e),t&&(this.options.height=t,this.options.autoHeight=this.options.height==="auto",t!=="auto"&&(this.dom.frame.style.height=t)),this.render({animate:!1})},links.Timeline.prototype.setVisibleChartRange=function(e,t,n){var r={};if(!e||!t)r=this.getDataRange(!0);e||(t?r.min&&r.min.valueOf()<t.valueOf()?e=r.min:(e=new Date(t),e.setDate(e.getDate()-7)):(e=new Date,e.setDate(e.getDate()-3))),t||(r.max?t=r.max:(t=new Date(e),t.setDate(t.getDate()+7))),t.valueOf()<=e.valueOf()&&(t=new Date(e),t.setDate(t.getDate()+7));var i=this.options.min?this.options.min.valueOf():undefined;i!=undefined&&e.valueOf()<i&&(e=new Date(i));var s=this.options.max?this.options.max.valueOf():undefined;s!=undefined&&t.valueOf()>s&&(t=new Date(s)),this.applyRange(e,t),n==undefined||n==1?this.render({animate:!1}):this.recalcConversion()},links.Timeline.prototype.setVisibleChartRangeAuto=function(){var e=this.getDataRange(!0),t=undefined,n=undefined;this.setVisibleChartRange(e.min,e.max)},links.Timeline.prototype.setVisibleChartRangeNow=function(){var e=new Date,t=this.end.getTime()-this.start.getTime(),n=new Date(e.getTime()-t/2),r=new Date(n.getTime()+t);this.setVisibleChartRange(n,r)},links.Timeline.prototype.getVisibleChartRange=function(){return{start:new Date(this.start),end:new Date(this.end)}},links.Timeline.prototype.getDataRange=function(e){var t=this.items,n=undefined,r=undefined;if(t)for(var i=0,s=t.length;i<s;i++){var o=t[i],u=o.start?o.start.valueOf():undefined,a=o.end?o.end.valueOf():u;n!=undefined&&u!=undefined?n=Math.min(n,u):n=u,r!=undefined&&a!=undefined?r=Math.max(r,a):r=a}if(n&&r&&e){var f=r.valueOf()-n.valueOf();n=new Date(n.valueOf()-f*.05),r=new Date(r.valueOf()+f*.05)}return{min:n?new Date(n):undefined,max:r?new Date(r):undefined}},links.Timeline.prototype.render=function(e){var t=this.reflowFrame(),n=this.reflowAxis(),r=this.reflowGroups(),i=this.reflowItems(),s=t||n||r||i,o=this.options.animate;e&&e.animate!=undefined&&(o=e.animate),this.recalcConversion(),this.filterItems(),this.stackItems(o),this.recalcItems();var u=this.repaint();if(u){var a=e?e.renderTimesLeft:undefined;a==undefined&&(a=5),a>0&&this.render({animate:e?e.animate:undefined,renderTimesLeft:a-1})}},links.Timeline.prototype.repaint=function(){var e=this.repaintFrame(),t=this.repaintAxis(),n=this.repaintGroups(),r=this.repaintItems();return this.repaintCurrentTime(),this.repaintCustomTime(),e||t||n||r},links.Timeline.prototype.reflowFrame=function(){var e=this.dom,t=this.options,n=this.size,r=!1,i=e.frame?e.frame.offsetWidth:0,s=e.frame?e.frame.clientHeight:0;return r=r||n.frameWidth!==i,r=r||n.frameHeight!==s,n.frameWidth=i,n.frameHeight=s,r},links.Timeline.prototype.repaintFrame=function(){var e=!1,t=this.dom,n=this.options,r=this.size;t.frame||(t.frame=document.createElement("DIV"),t.frame.className="timeline-frame",t.frame.style.position="relative",t.frame.style.overflow="hidden",t.container.appendChild(t.frame),e=!0);var i=n.autoHeight?r.actualHeight+"px":n.height||"100%",s=n.width||"100%";e=e||t.frame.style.height!=i,e=e||t.frame.style.width!=s,t.frame.style.height=i,t.frame.style.width=s;if(!t.content){t.content=document.createElement("DIV"),t.content.style.position="relative",t.content.style.overflow="hidden",t.frame.appendChild(t.content);var o=document.createElement("DIV");o.style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.height="100%",o.style.width="0px",t.content.appendChild(o),t.contentTimelines=o;var u=this.eventParams,a=this;u.onMouseDown||(u.onMouseDown=function(e){a.onMouseDown(e)},links.Timeline.addEventListener(t.content,"mousedown",u.onMouseDown)),u.onTouchStart||(u.onTouchStart=function(e){a.onTouchStart(e)},links.Timeline.addEventListener(t.content,"touchstart",u.onTouchStart)),u.onMouseWheel||(u.onMouseWheel=function(e){a.onMouseWheel(e)},links.Timeline.addEventListener(t.content,"mousewheel",u.onMouseWheel)),u.onDblClick||(u.onDblClick=function(e){a.onDblClick(e)},links.Timeline.addEventListener(t.content,"dblclick",u.onDblClick)),e=!0}return t.content.style.left=r.contentLeft+"px",t.content.style.top="0px",t.content.style.width=r.contentWidth+"px",t.content.style.height=r.frameHeight+"px",this.repaintNavigation(),e},links.Timeline.prototype.reflowAxis=function(){var e=!1,t=this.dom,n=this.options,r=this.size,i=t.axis,s=i&&i.characterMinor?i.characterMinor.clientWidth:0,o=i&&i.characterMinor?i.characterMinor.clientHeight:0,u=i&&i.characterMajor?i.characterMajor.clientWidth:0,a=i&&i.characterMajor?i.characterMajor.clientHeight:0,f=(n.showMinorLabels?o:0)+(n.showMajorLabels?a:0),l=n.axisOnTop?0:r.frameHeight-f,c=n.axisOnTop?f:l;e=e||r.axis.top!==l,e=e||r.axis.line!==c,e=e||r.axis.height!==f,r.axis.top=l,r.axis.line=c,r.axis.height=f,r.axis.labelMajorTop=n.axisOnTop?0:c+(n.showMinorLabels?o:0),r.axis.labelMinorTop=n.axisOnTop?n.showMajorLabels?a:0:c,r.axis.lineMinorTop=n.axisOnTop?r.axis.labelMinorTop:0,r.axis.lineMinorHeight=n.showMajorLabels?r.frameHeight-a:r.frameHeight,i&&i.minorLines&&i.minorLines.length?r.axis.lineMinorWidth=i.minorLines[0].offsetWidth:r.axis.lineMinorWidth=1,i&&i.majorLines&&i.majorLines.length?r.axis.lineMajorWidth=i.majorLines[0].offsetWidth:r.axis.lineMajorWidth=1,e=e||r.axis.characterMinorWidth!==s,e=e||r.axis.characterMinorHeight!==o,e=e||r.axis.characterMajorWidth!==u,e=e||r.axis.characterMajorHeight!==a,r.axis.characterMinorWidth=s,r.axis.characterMinorHeight=o,r.axis.characterMajorWidth=u,r.axis.characterMajorHeight=a;var h=Math.max(r.frameHeight-f,0);return r.contentLeft=n.groupsOnRight?0:r.groupsWidth,r.contentWidth=Math.max(r.frameWidth-r.groupsWidth,0),r.contentHeight=h,e},links.Timeline.prototype.repaintAxis=function(){var e=!1,t=this.dom,n=this.options,r=this.size,i=this.step,s=t.axis;s||(s={},t.axis=s),r.axis.properties||(r.axis.properties={}),s.minorTexts||(s.minorTexts=[]),s.minorLines||(s.minorLines=[]),s.majorTexts||(s.majorTexts=[]),s.majorLines||(s.majorLines=[]),s.frame||(s.frame=document.createElement("DIV"),s.frame.style.position="absolute",s.frame.style.left="0px",s.frame.style.top="0px",t.content.appendChild(s.frame)),t.content.removeChild(s.frame),s.frame.style.width=r.contentWidth+"px",s.frame.style.height=r.axis.height+"px";var o=this.screenToTime(0),u=this.screenToTime(r.contentWidth);r.axis.characterMinorWidth&&(this.minimumStep=this.screenToTime(r.axis.characterMinorWidth*6).valueOf()-this.screenToTime(0).valueOf(),i.setRange(o,u,this.minimumStep));var a=this.repaintAxisCharacters();e=e||a,this.repaintAxisStartOverwriting(),i.start();var f=undefined,l=0;while(!i.end()&&l<1e3){l++;var c=i.getCurrent(),h=this.timeToScreen(c),p=i.isMajor();n.showMinorLabels&&this.repaintAxisMinorText(h,i.getLabelMinor()),p&&n.showMajorLabels?(h>0&&(f===undefined&&(f=h),this.repaintAxisMajorText(h,i.getLabelMajor())),this.repaintAxisMajorLine(h)):this.repaintAxisMinorLine(h),i.next()}if(n.showMajorLabels){var d=this.screenToTime(0),v=this.step.getLabelMajor(d),m=v.length*r.axis.characterMajorWidth+10;(f===undefined||m<f)&&this.repaintAxisMajorText(0,v,d)}return this.repaintAxisEndOverwriting(),this.repaintAxisHorizontal(),t.content.insertBefore(s.frame,t.content.firstChild),e},links.Timeline.prototype.repaintAxisCharacters=function(){var e=!1,t=this.dom,n=t.axis,r;if(!n.characterMinor){r=document.createTextNode("0");var i=document.createElement("DIV");i.className="timeline-axis-text timeline-axis-text-minor",i.appendChild(r),i.style.position="absolute",i.style.visibility="hidden",i.style.paddingLeft="0px",i.style.paddingRight="0px",n.frame.appendChild(i),n.characterMinor=i,e=!0}if(!n.characterMajor){r=document.createTextNode("0");var s=document.createElement("DIV");s.className="timeline-axis-text timeline-axis-text-major",s.appendChild(r),s.style.position="absolute",s.style.visibility="hidden",s.style.paddingLeft="0px",s.style.paddingRight="0px",n.frame.appendChild(s),n.characterMajor=s,e=!0}return e},links.Timeline.prototype.repaintAxisStartOverwriting=function(){var e=this.size.axis.properties;e.minorTextNum=0,e.minorLineNum=0,e.majorTextNum=0,e.majorLineNum=0},links.Timeline.prototype.repaintAxisEndOverwriting=function(){var e=this.dom,t=this.size.axis.properties,n=this.dom.axis.frame,r,i=e.axis.minorTexts;r=t.minorTextNum;while(i.length>r){var s=i[r];n.removeChild(s),i.splice(r,1)}var o=e.axis.minorLines;r=t.minorLineNum;while(o.length>r){var u=o[r];n.removeChild(u),o.splice(r,1)}var a=e.axis.majorTexts;r=t.majorTextNum;while(a.length>r){var f=a[r];n.removeChild(f),a.splice(r,1)}var l=e.axis.majorLines;r=t.majorLineNum;while(l.length>r){var c=l[r];n.removeChild(c),l.splice(r,1)}},links.Timeline.prototype.repaintAxisHorizontal=function(){var e=this.dom.axis,t=this.size,n=this.options,r=n.showMinorLabels||n.showMajorLabels;if(r){if(!e.backgroundLine){var i=document.createElement("DIV");i.className="timeline-axis",i.style.position="absolute",i.style.left="0px",i.style.width="100%",i.style.border="none",e.frame.insertBefore(i,e.frame.firstChild),e.backgroundLine=i}e.backgroundLine&&(e.backgroundLine.style.top=t.axis.top+"px",e.backgroundLine.style.height=t.axis.height+"px")}else e.backgroundLine&&(e.frame.removeChild(e.backgroundLine),delete e.backgroundLine);if(r){if(e.line){var s=e.frame.removeChild(e.line);e.frame.appendChild(s)}else{var s=document.createElement("DIV");s.className="timeline-axis",s.style.position="absolute",s.style.left="0px",s.style.width="100%",s.style.height="0px",e.frame.appendChild(s),e.line=s}e.line.style.top=t.axis.line+"px"}else e.line&&e.line.parentElement&&(e.frame.removeChild(e.line),delete e.line)},links.Timeline.prototype.repaintAxisMinorText=function(e,t){var n=this.size,r=this.dom,i=n.axis.properties,s=r.axis.frame,o=r.axis.minorTexts,u=i.minorTextNum,a;if(u<o.length)a=o[u];else{var f=document.createTextNode("");a=document.createElement("DIV"),a.appendChild(f),a.className="timeline-axis-text timeline-axis-text-minor",a.style.position="absolute",s.appendChild(a),o.push(a)}a.childNodes[0].nodeValue=t,a.style.left=e+"px",a.style.top=n.axis.labelMinorTop+"px",i.minorTextNum++},links.Timeline.prototype.repaintAxisMinorLine=function(e){var t=this.size.axis,n=this.dom,r=t.properties,i=n.axis.frame,s=n.axis.minorLines,o=r.minorLineNum,u;o<s.length?u=s[o]:(u=document.createElement("DIV"),u.className="timeline-axis-grid timeline-axis-grid-minor",u.style.position="absolute",u.style.width="0px",i.appendChild(u),s.push(u)),u.style.top=t.lineMinorTop+"px",u.style.height=t.lineMinorHeight+"px",u.style.left=e-t.lineMinorWidth/2+"px",r.minorLineNum++},links.Timeline.prototype.repaintAxisMajorText=function(e,t){var n=this.size,r=n.axis.properties,i=this.dom.axis.frame,s=this.dom.axis.majorTexts,o=r.majorTextNum,u;if(o<s.length)u=s[o];else{var a=document.createTextNode(t);u=document.createElement("DIV"),u.className="timeline-axis-text timeline-axis-text-major",u.appendChild(a),u.style.position="absolute",u.style.top="0px",i.appendChild(u),s.push(u)}u.childNodes[0].nodeValue=t,u.style.top=n.axis.labelMajorTop+"px",u.style.left=e+"px",r.majorTextNum++},links.Timeline.prototype.repaintAxisMajorLine=function(e){var t=this.size,n=t.axis.properties,r=this.size.axis,i=this.dom.axis.frame,s=this.dom.axis.majorLines,o=n.majorLineNum,u;o<s.length?u=s[o]:(u=document.createElement("DIV"),u.className="timeline-axis-grid timeline-axis-grid-major",u.style.position="absolute",u.style.top="0px",u.style.width="0px",i.appendChild(u),s.push(u)),u.style.left=e-r.lineMajorWidth/2+"px",u.style.height=t.frameHeight+"px",n.majorLineNum++},links.Timeline.prototype.reflowItems=function(){var e=!1,t,n,r,i=this.dom,s=this.groups,o=this.visibleItems;s&&s.forEach(function(e){e.itemsHeight=0});for(t=0,n=o.length;t<n;t++){var u=o[t],a=u.dom;r=u.group;if(a){var f=a?a.clientWidth:0,l=a?a.clientHeight:0;e=e||u.width!=f,e=e||u.height!=l,u.width=f,u.height=l,u.reflow()}r&&(r.itemsHeight=r.itemsHeight?Math.max(r.itemsHeight,u.height):u.height)}return e},links.Timeline.prototype.recalcItems=function(){var e=!1,t,n,r,i,s,o,u=this.groups,a=this.size,f=this.options,l=this.visibleItems,c=0;if(u.length==0){if(f.autoHeight||f.cluster){var h=0,p=0;if(this.stack&&this.stack.finalItems){s=this.stack.finalItems,i=s[0],i&&i.top&&(h=i.top,p=i.top+i.height);for(t=1,n=s.length;t<n;t++)i=s[t],h=Math.min(h,i.top),p=Math.max(p,i.top+i.height)}else{r=l[0],r&&r.top&&(h=r.top,p=r.top+r.height);for(t=1,n=l.length;t<n;t++)r=l[t],r.top&&(h=Math.min(h,r.top),p=Math.max(p,r.top+r.height))}c=p-h+2*f.eventMarginAxis+a.axis.height,c<f.minHeight&&(c=f.minHeight);if(a.actualHeight!=c&&f.autoHeight&&!f.axisOnTop){var d=c-a.actualHeight;if(this.stack&&this.stack.finalItems){s=this.stack.finalItems;for(t=0,n=s.length;t<n;t++)s[t].top+=d,s[t].item.top+=d}else for(t=0,n=l.length;t<n;t++)l[t].top+=d}}}else{c=a.axis.height+2*f.eventMarginAxis;for(t=0,n=u.length;t<n;t++){o=u[t];var v=Math.max(o.labelHeight||0,o.itemsHeight||0);e=e||v!=o.height,o.height=v,c+=u[t].height+f.eventMargin}var m=f.eventMargin,g=f.axisOnTop?f.eventMarginAxis+m/2:a.contentHeight-f.eventMarginAxis+m/2,y=a.axis.height;for(t=0,n=u.length;t<n;t++)o=u[t],f.axisOnTop?(o.top=g+y,o.labelTop=g+y+(o.height-o.labelHeight)/2,o.lineTop=g+y+o.height+m/2,g+=o.height+m):(g-=o.height+m,o.top=g,o.labelTop=g+(o.height-o.labelHeight)/2,o.lineTop=g-m/2);for(t=0,n=l.length;t<n;t++)r=l[t],o=r.group,o&&(r.top=o.top);e=!0}return c<f.minHeight&&(c=f.minHeight),e=e||c!=a.actualHeight,a.actualHeight=c,e},links.Timeline.prototype.clearItems=function(){var e=this.visibleItems;for(var t=0,n=e.length;t<n;t++)this.visibleItems[t].visible=!1;this.repaintItems(),this.items=[],this.visibleItems=[],this.clusterFactory.clear()},links.Timeline.prototype.repaintItems=function(){var e,t,n,r=!1,i=this.dom,s=this.size,o=this.items;i.items||(i.items={});var u=i.items.frame;u||(u=document.createElement("DIV"),u.style.position="relative",i.content.appendChild(u),i.items.frame=u),u.style.left="0px",u.style.top=s.items.top+"px",u.style.height="0px",i.content.removeChild(u);var a=[],f;o.forEach(function(e){f=e.repaint(u),r=r||f,f&&e.getImageUrls(a)});var l=this.clusterFactory.getClusters(this.conversion.factor);l!=this.clusters&&(this.clusters&&this.clusters.forEach(function(e){e.hideDOM(u),e.items.forEach(function(e){delete e.cluster})}),l.forEach(function(e){var t=e.repaint(u);r=r||t,t&&e.getImageUrls(a),e.items.forEach(function(t){t.cluster=e})}),this.clusters=l,r=!0),l.forEach(function(e){f=e.repaint(u),r=r||f,f&&e.getImageUrls(a)});var c=this.visibleItems;for(e=0,t=c.length;e<t;e++)n=c[e],n.updatePosition(this);this.repaintDeleteButton(),this.repaintDragAreas(),i.content.appendChild(u);if(a.length){var h=this,p=function(){h.render()},d=!1;links.imageloader.loadAll(a,p,d)}return r},links.Timeline.prototype.reflowGroups=function(){var e=!1,t=this.options,n=this.size,r=this.dom,i=0,s=this.groups,o=this.dom.groups?this.dom.groups.labels:[];for(var u=0,a=s.length;u<a;u++){var f=s[u],l=o[u];f.labelWidth=l?l.clientWidth:0,f.labelHeight=l?l.clientHeight:0,f.width=f.labelWidth,i=Math.max(i,f.width)}t.groupsWidth!==undefined&&(i=r.groups.frame?r.groups.frame.clientWidth:0),i+=1;var c=t.groupsOnRight?n.frameWidth-i:0;return e=e||n.groupsWidth!==i,e=e||n.groupsLeft!==c,n.groupsWidth=i,n.groupsLeft=c,e},links.Timeline.prototype.repaintGroups=function(){var e=this.dom,t=this.options,n=this.size,r=this.groups;e.groups===undefined&&(e.groups={});var i=e.groups.labels;i||(i=[],e.groups.labels=i);var s=e.groups.labelLines;s||(s=[],e.groups.labelLines=s);var o=e.groups.itemLines;o||(o=[],e.groups.itemLines=o);var u=e.groups.frame;u||(u=document.createElement("DIV"),u.className="timeline-groups-axis",u.style.position="absolute",u.style.overflow="hidden",u.style.top="0px",u.style.height="100%",e.frame.appendChild(u),e.groups.frame=u),u.style.left=n.groupsLeft+"px",u.style.width=t.groupsWidth!==undefined?t.groupsWidth:n.groupsWidth+"px",r.length==0?u.style.display="none":u.style.display="";var a=i.length,f=r.length;for(var l=0,c=Math.min(a,f);l<c;l++){var h=r[l],p=i[l];p.innerHTML=this.getGroupName(h),p.style.display=""}for(var l=a;l<f;l++){var h=r[l],p=document.createElement("DIV");p.className="timeline-groups-text",p.style.position="absolute",t.groupsWidth===undefined&&(p.style.whiteSpace="nowrap"),p.innerHTML=this.getGroupName(h),u.appendChild(p),i[l]=p;var d=document.createElement("DIV");d.className="timeline-axis-grid timeline-axis-grid-minor",d.style.position="absolute",d.style.left="0px",d.style.width="100%",d.style.height="0px",d.style.borderTopStyle="solid",u.appendChild(d),s[l]=d;var v=document.createElement("DIV");v.className="timeline-axis-grid timeline-axis-grid-minor",v.style.position="absolute",v.style.left="0px",v.style.width="100%",v.style.height="0px",v.style.borderTopStyle="solid",e.content.insertBefore(v,e.content.firstChild),o[l]=v}for(var l=f;l<a;l++){var p=i[l],d=s[l],v=o[l];u.removeChild(p),u.removeChild(d),e.content.removeChild(v)}i.splice(f,a-f),s.splice(f,a-f),o.splice(f,a-f),u.style.borderStyle=t.groupsOnRight?"none none none solid":"none solid none none";for(var l=0,c=r.length;l<c;l++){var h=r[l],p=i[l],d=s[l],v=o[l];p.style.top=h.labelTop+"px",d.style.top=h.lineTop+"px",v.style.top=h.lineTop+"px",v.style.width=n.contentWidth+"px"}if(!e.groups.background){var m=document.createElement("DIV");m.className="timeline-axis",m.style.position="absolute",m.style.left="0px",m.style.width="100%",m.style.border="none",u.appendChild(m),e.groups.background=m}e.groups.background.style.top=n.axis.top+"px",e.groups.background.style.height=n.axis.height+"px";if(!e.groups.line){var g=document.createElement("DIV");g.className="timeline-axis",g.style.position="absolute",g.style.left="0px",g.style.width="100%",g.style.height="0px",u.appendChild(g),e.groups.line=g}e.groups.line.style.top=n.axis.line+"px";if(e.groups.frame&&r.length){var y=[];links.imageloader.filterImageUrls(e.groups.frame,y);if(y.length){var b=function(){timeline.render()},w=!1;links.imageloader.loadAll(y,b,w)}}},links.Timeline.prototype.repaintCurrentTime=function(){var e=this.options,t=this.dom,n=this.size;if(!e.showCurrentTime){t.currentTime&&(t.contentTimelines.removeChild(t.currentTime),delete t.currentTime);return}if(!t.currentTime){var r=document.createElement("DIV");r.className="timeline-currenttime",r.style.position="absolute",r.style.top="0px",r.style.height="100%",t.contentTimelines.appendChild(r),t.currentTime=r}var i=new Date,s=new Date(i.getTime()+this.clientTimeOffset),o=this.timeToScreen(s),u=o>-n.contentWidth&&o<2*n.contentWidth;t.currentTime.style.display=u?"":"none",t.currentTime.style.left=o+"px",t.currentTime.title="Current time: "+s,this.currentTimeTimer!=undefined&&(clearTimeout(this.currentTimeTimer),delete this.currentTimeTimer);var a=this,f=function(){a.repaintCurrentTime()},l=1/this.conversion.factor/2;l<30&&(l=30),this.currentTimeTimer=setTimeout(f,l)},links.Timeline.prototype.repaintCustomTime=function(){var e=this.options,t=this.dom,n=this.size;if(!e.showCustomTime){t.customTime&&(t.contentTimelines.removeChild(t.customTime),delete t.customTime);return}if(!t.customTime){var r=document.createElement("DIV");r.className="timeline-customtime",r.style.position="absolute",r.style.top="0px",r.style.height="100%";var i=document.createElement("DIV");i.style.position="relative",i.style.top="0px",i.style.left="-10px",i.style.height="100%",i.style.width="20px",r.appendChild(i),t.contentTimelines.appendChild(r),t.customTime=r,this.customTime=new Date}var s=this.timeToScreen(this.customTime),o=s>-n.contentWidth&&s<2*n.contentWidth;t.customTime.style.display=o?"":"none",t.customTime.style.left=s+"px",t.customTime.title="Time: "+this.customTime},links.Timeline.prototype.repaintDeleteButton=function(){var e=this,t=this.options,n=this.dom,r=this.size,i=n.items.frame,s=n.items.deleteButton;s||(s=document.createElement("DIV"),s.className="timeline-navigation-delete",s.style.position="absolute",i.appendChild(s),n.items.deleteButton=s);var o=this.selection?this.selection.index:-1,u=this.selection?this.items[o]:undefined;if(u&&u.visible&&this.isEditable(u)){var a=u.getRight(this),f=u.top;s.style.left=a+"px",s.style.top=f+"px",s.style.display="",i.removeChild(s),i.appendChild(s)}else s.style.display="none"},links.Timeline.prototype.repaintDragAreas=function(){var e=this,t=this.options,n=this.dom,r=this.dom.items.frame,i=n.items.dragLeft;i||(i=document.createElement("DIV"),i.className="timeline-event-range-drag-left",i.style.width=t.dragAreaWidth+"px",i.style.position="absolute",r.appendChild(i),n.items.dragLeft=i);var s=n.items.dragRight;s||(s=document.createElement("DIV"),s.className="timeline-event-range-drag-right",s.style.width=t.dragAreaWidth+"px",s.style.position="absolute",r.appendChild(s),n.items.dragRight=s);var o=this.selection?this.selection.index:-1,u=this.selection?this.items[o]:undefined;if(u&&u.visible&&this.isEditable(u)&&u instanceof links.Timeline.ItemRange){var a=this.timeToScreen(u.start),f=this.timeToScreen(u.end),l=u.top,c=u.height;i.style.left=a+"px",i.style.top=l+"px",i.style.height=c+"px",i.style.display="",r.removeChild(i),r.appendChild(i),s.style.left=f-t.dragAreaWidth+"px",s.style.top=l+"px",s.style.height=c+"px",s.style.display="",r.removeChild(s),r.appendChild(s)}else i.style.display="none",s.style.display="none"},links.Timeline.prototype.repaintNavigation=function(){var e=this,t=this.options,n=this.dom,r=n.frame,i=n.navBar;if(!i){if(t.showNavigation||t.showButtonNew)i=document.createElement("DIV"),i.style.position="absolute",i.className="timeline-navigation",t.groupsOnRight?i.style.left="10px":i.style.right="10px",t.axisOnTop?i.style.bottom="10px":i.style.top="10px",n.navBar=i,r.appendChild(i);if(t.editable&&t.showButtonNew){i.addButton=document.createElement("DIV"),i.addButton.className="timeline-navigation-new",i.addButton.title="Create new event";var s=function(n){links.Timeline.preventDefault(n),links.Timeline.stopPropagation(n);var r=e.size.contentWidth,i=r/2,s=e.screenToTime(i-r/10),o=e.screenToTime(i+r/10);t.snapEvents&&(e.step.snap(s),e.step.snap(o));var u=e.groups.length?e.groups[0].content:undefined,a=u.match(/recursive/)?"true":"false";this.addItem({start:s,end:o,content:'<span class="secret">{"type":"slot", "recursive":'+a+', "state":"com.ask-cs.State.Available"}</span>',group:u,className:"state-available"});var f=e.items.length-1;e.selectItem(f),e.applyAdd=!0,e.trigger("add"),e.applyAdd||e.deleteItem(f)};links.Timeline.addEventListener(i.addButton,"mousedown",s),i.appendChild(i.addButton)}t.editable&&t.showButtonNew&&t.showNavigation&&(i.addButton.style.borderRightWidth="1px",i.addButton.style.borderRightStyle="solid");if(t.showNavigation){i.zoomInButton=document.createElement("DIV"),i.zoomInButton.className="timeline-navigation-zoom-in",i.zoomInButton.title="Zoom in";var o=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.zoom(.4),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(i.zoomInButton,"mousedown",o),i.appendChild(i.zoomInButton),i.zoomOutButton=document.createElement("DIV"),i.zoomOutButton.className="timeline-navigation-zoom-out",i.zoomOutButton.title="Zoom out";var u=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.zoom(-0.4),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(i.zoomOutButton,"mousedown",u),i.appendChild(i.zoomOutButton),i.moveLeftButton=document.createElement("DIV"),i.moveLeftButton.className="timeline-navigation-move-left",i.moveLeftButton.title="Move left";var a=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.move(-0.2),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(i.moveLeftButton,"mousedown",a),i.appendChild(i.moveLeftButton),i.moveRightButton=document.createElement("DIV"),i.moveRightButton.className="timeline-navigation-move-right",i.moveRightButton.title="Move right";var f=function(t){links.Timeline.preventDefault(t),links.Timeline.stopPropagation(t),e.move(.2),e.trigger("rangechange"),e.trigger("rangechanged")};links.Timeline.addEventListener(i.moveRightButton,"mousedown",f),i.appendChild(i.moveRightButton)}}},links.Timeline.prototype.setCurrentTime=function(e){var t=new Date;this.clientTimeOffset=e.getTime()-t.getTime(),this.repaintCurrentTime()},links.Timeline.prototype.getCurrentTime=function(){var e=new Date;return new Date(e.getTime()+this.clientTimeOffset)},links.Timeline.prototype.setCustomTime=function(e){this.customTime=new Date(e),this.repaintCustomTime()},links.Timeline.prototype.getCustomTime=function(){return new Date(this.customTime)},links.Timeline.prototype.setScale=function(e,t){this.step.setScale(e,t),this.render()},links.Timeline.prototype.setAutoScale=function(e){this.step.setAutoScale(e),this.render()},links.Timeline.prototype.redraw=function(){this.setData(this.data)},links.Timeline.prototype.checkResize=function(){this.render()},links.Timeline.prototype.isEditable=function(e){return e?e.editable!=undefined?e.editable:this.options.editable:!1},links.Timeline.prototype.recalcConversion=function(){this.conversion.offset=parseFloat(this.start.valueOf()),this.conversion.factor=parseFloat(this.size.contentWidth)/parseFloat(this.end.valueOf()-this.start.valueOf())},links.Timeline.prototype.screenToTime=function(e){var t=this.conversion,n=new Date(parseFloat(e)/t.factor+t.offset);return n},links.Timeline.prototype.timeToScreen=function(e){var t=this.conversion,n=(e.valueOf()-t.offset)*t.factor;return n},links.Timeline.prototype.onTouchStart=function(e){var t=this.eventParams,n=this;if(t.touchDown)return;t.touchDown=!0,t.zoomed=!1,this.onMouseDown(e),t.onTouchMove||(t.onTouchMove=function(e){n.onTouchMove(e)},links.Timeline.addEventListener(document,"touchmove",t.onTouchMove)),t.onTouchEnd||(t.onTouchEnd=function(e){n.onTouchEnd(e)},links.Timeline.addEventListener(document,"touchend",t.onTouchEnd));var r=links.Timeline.getTarget(e),i=this.getItemIndex(r);t.doubleTapStartPrev=t.doubleTapStart,t.doubleTapStart=(new Date).getTime(),t.doubleTapItemPrev=t.doubleTapItem,t.doubleTapItem=i,links.Timeline.preventDefault(e)},links.Timeline.prototype.onTouchMove=function(e){var t=this.eventParams;e.scale&&e.scale!==1&&(t.zoomed=!0);if(!t.zoomed)this.onMouseMove(e);else if(this.options.zoomable){t.zoomed=!0;var n=e.scale,r=t.end.valueOf()-t.start.valueOf(),i=r/n,s=i-r,o=new Date(parseInt(t.start.valueOf()-s/2)),u=new Date(parseInt(t.end.valueOf()+s/2));this.setVisibleChartRange(o,u),this.trigger("rangechange")}links.Timeline.preventDefault(e)},links.Timeline.prototype.onTouchEnd=function(e){var t=this.eventParams,n=this;t.touchDown=!1,t.zoomed&&this.trigger("rangechanged"),t.onTouchMove&&(links.Timeline.removeEventListener(document,"touchmove",t.onTouchMove),delete t.onTouchMove),t.onTouchEnd&&(links.Timeline.removeEventListener(document,"touchend",t.onTouchEnd),delete t.onTouchEnd),this.onMouseUp(e);var r=500,i=(new Date).getTime(),s=links.Timeline.getTarget(e),o=this.getItemIndex(s);t.doubleTapStartPrev&&i-t.doubleTapStartPrev<r&&t.doubleTapItem==t.doubleTapItemPrev&&(t.touchDown=!0,n.onDblClick(e),t.touchDown=!1),links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseDown=function(e){e=e||window.event;var t=this.eventParams,n=this.options,r=this.dom,i=e.which?e.which==1:e.button==1;if(!i&&!t.touchDown)return;t.touchDown?(t.mouseX=e.targetTouches[0].clientX,t.mouseY=e.targetTouches[0].clientY):(t.mouseX=e.clientX,t.mouseY=e.clientY),t.mouseX===undefined&&(t.mouseX=0),t.mouseY===undefined&&(t.mouseY=0),t.frameLeft=links.Timeline.getAbsoluteLeft(this.dom.content),t.frameTop=links.Timeline.getAbsoluteTop(this.dom.content),t.previousLeft=0,t.previousOffset=0,t.moved=!1,t.start=new Date(this.start),t.end=new Date(this.end),t.target=links.Timeline.getTarget(e);var s=r.items&&r.items.dragLeft?r.items.dragLeft:undefined,o=r.items&&r.items.dragRight?r.items.dragRight:undefined;t.itemDragLeft=t.target===s,t.itemDragRight=t.target===o,t.itemDragLeft||t.itemDragRight?t.itemIndex=this.selection?this.selection.index:undefined:t.itemIndex=this.getItemIndex(t.target),t.customTime=t.target===r.customTime||t.target.parentNode===r.customTime?this.customTime:undefined,t.addItem=n.editable&&(e.shiftKey||e.ctrlKey);if(t.addItem){var u=t.mouseX-t.frameLeft,a=t.mouseY-t.frameTop,f=this.screenToTime(u);n.snapEvents&&this.step.snap(f);var l=new Date(f),c=this.getGroupFromHeight(a),h=this.getGroupName(c).match(/recursive/)?"true":"false";typeof window.slotsbulk=="undefined"&&(window.slotsbulk=[]),window.slotsbulk.push({start:(new Date(f)).getTime()/1e3,end:(new Date(l)).getTime()/1e3,recursive:h,state:"available"}),this.addItem({start:f,end:l,content:'<span class="secret">{"type":"slot", "recursive":'+h+', "state":"com.ask-cs.State.Available"}</span>',group:this.getGroupName(c),className:"state-new"}),t.itemIndex=this.items.length-1,this.selectItem(t.itemIndex),t.itemDragRight=!0}var p=this.items[t.itemIndex],d=this.isSelected(t.itemIndex);t.editItem=d&&this.isEditable(p),t.editItem?(t.itemStart=p.start,t.itemEnd=p.end,t.itemGroup=p.group,t.itemLeft=p.start?this.timeToScreen(p.start):undefined,t.itemRight=p.end?this.timeToScreen(p.end):undefined):this.dom.frame.style.cursor="move";if(!t.touchDown){var v=this;t.onMouseMove||(t.onMouseMove=function(e){v.onMouseMove(e)},links.Timeline.addEventListener(document,"mousemove",t.onMouseMove)),t.onMouseUp||(t.onMouseUp=function(e){v.onMouseUp(e)},links.Timeline.addEventListener(document,"mouseup",t.onMouseUp)),links.Timeline.preventDefault(e)}},links.Timeline.prototype.onMouseMove=function(e){e=e||window.event;var t=this.eventParams,n=this.size,r=this.dom,i=this.options,s,o;t.touchDown?(s=e.targetTouches[0].clientX,o=e.targetTouches[0].clientY):(s=e.clientX,o=e.clientY),s===undefined&&(s=0),o===undefined&&(o=0),t.mouseX===undefined&&(t.mouseX=s),t.mouseY===undefined&&(t.mouseY=o);var u=parseFloat(s)-t.mouseX,a=parseFloat(o)-t.mouseY;Math.abs(u)>=1&&(t.moved=!0);if(t.customTime){var f=this.timeToScreen(t.customTime),l=f+u;this.customTime=this.screenToTime(l),this.repaintCustomTime(),this.trigger("timechange")}else if(t.editItem){var c=this.items[t.itemIndex],h,p;t.itemDragLeft?(h=t.itemLeft+u,p=t.itemRight,c.start=this.screenToTime(h),i.snapEvents&&(this.step.snap(c.start),h=this.timeToScreen(c.start)),h>p&&(h=p,c.start=this.screenToTime(h))):t.itemDragRight?(h=t.itemLeft,p=t.itemRight+u,c.end=this.screenToTime(p),i.snapEvents&&(this.step.snap(c.end),p=this.timeToScreen(c.end)),p<h&&(p=h,c.end=this.screenToTime(p))):(h=t.itemLeft+u,c.start=this.screenToTime(h),i.snapEvents&&(this.step.snap(c.start),h=this.timeToScreen(c.start)),c.end&&(p=h+(t.itemRight-t.itemLeft),c.end=this.screenToTime(p))),c.setPosition(h,p);if(this.groups.length==0)this.render();else{var d=o-t.frameTop,v=this.getGroupFromHeight(d);if(i.groupsChangeable&&c.group!==v){var m=this.items.indexOf(c);this.changeItem(m,{group:this.getGroupName(v)})}else this.repaintDeleteButton(),this.repaintDragAreas()}}else if(i.moveable){var g=t.end.valueOf()-t.start.valueOf(),y=Math.round(parseFloat(-u)/n.contentWidth*g),b=new Date(t.start.valueOf()+y),w=new Date(t.end.valueOf()+y);this.applyRange(b,w);var E=this.start.valueOf()-b.valueOf();E&&(y+=E),this.recalcConversion();var S=t.previousLeft||0,x=parseFloat(r.items.frame.style.left)||0,T=t.previousOffset||0,N=T+(x-S),C=-y/g*n.contentWidth+N;r.items.frame.style.left=C+"px",t.previousOffset=N,t.previousLeft=parseFloat(r.items.frame.style.left)||C,this.repaintCurrentTime(),this.repaintCustomTime(),this.repaintAxis(),this.trigger("rangechange")}links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseUp=function(e){var t=this.eventParams,n=this.options;e=e||window.event,this.dom.frame.style.cursor="auto",t.onMouseMove&&(links.Timeline.removeEventListener(document,"mousemove",t.onMouseMove),delete t.onMouseMove),t.onMouseUp&&(links.Timeline.removeEventListener(document,"mouseup",t.onMouseUp),delete t.onMouseUp);if(t.customTime)this.trigger("timechanged");else if(t.editItem){var r=this.items[t.itemIndex];if(t.moved||t.addItem){this.applyChange=!0,this.applyAdd=!0,this.updateData(t.itemIndex,{start:r.start,end:r.end}),this.trigger(t.addItem?"add":"change");if(t.addItem)this.applyAdd?this.updateData(t.itemIndex,{start:r.start,end:r.end,content:r.content,group:this.getGroupName(r.group)}):this.deleteItem(t.itemIndex);else if(this.applyChange)this.updateData(t.itemIndex,{start:r.start,end:r.end});else{delete this.applyChange,delete this.applyAdd;var r=this.items[t.itemIndex],i=r.dom;r.start=t.itemStart,r.end=t.itemEnd,r.group=t.itemGroup,r.setPosition(t.itemLeft,t.itemRight)}this.render()}}else!t.moved&&!t.zoomed?t.target===this.dom.items.deleteButton?this.selection&&this.confirmDeleteItem(this.selection.index):n.selectable&&(t.itemIndex!==undefined?this.isSelected(t.itemIndex)||(this.selectItem(t.itemIndex),this.trigger("select")):(this.unselectItem(),this.trigger("select"))):(this.render(),(t.moved&&n.moveable||t.zoomed&&n.zoomable)&&this.trigger("rangechanged"))},links.Timeline.prototype.onDblClick=function(e){var t=this.eventParams,n=this.options,r=this.dom,i=this.size;e=e||window.event;if(t.itemIndex!==undefined){var s=this.items[t.itemIndex];s&&this.isEditable(s)&&this.trigger("edit")}else if(n.editable){t.touchDown||(t.mouseX=e.clientX,t.mouseY=e.clientY),t.mouseX===undefined&&(t.mouseX=0),t.mouseY===undefined&&(t.mouseY=0);var o=t.mouseX-links.Timeline.getAbsoluteLeft(r.content),u=t.mouseY-links.Timeline.getAbsoluteTop(r.content),a=this.screenToTime(o),f=this.screenToTime(o+i.frameWidth/10);n.snapEvents&&(this.step.snap(a),this.step.snap(f));var l=this.getGroupFromHeight(u),c=this.getGroupName(l).match(/recursive/)?"true":"false";this.addItem({start:a,end:f,content:'<span class="secret">{"type":"slot", "recursive":'+c+', "state":"com.ask-cs.State.Available"}</span>',group:this.getGroupName(l),className:"state-available"}),t.itemIndex=this.items.length-1,this.selectItem(t.itemIndex),this.applyAdd=!0,this.trigger("add"),this.applyAdd||this.deleteItem(t.itemIndex)}links.Timeline.preventDefault(e)},links.Timeline.prototype.onMouseWheel=function(e){if(!this.options.zoomable)return;e||(e=window.event);var t=0;e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3);if(t){var n=this,r=function(){var r=t/5,i=links.Timeline.getAbsoluteLeft(n.dom.content),s=e.clientX!=undefined&&i!=undefined?n.screenToTime(e.clientX-i):undefined;n.zoom(r,s),n.trigger("rangechange"),n.trigger("rangechanged")};r()}links.Timeline.preventDefault(e)},links.Timeline.prototype.zoom=function(e,t){t==undefined&&(t=new Date((this.start.valueOf()+this.end.valueOf())/2)),e>=1&&(e=.9),e<=-1&&(e=-0.9),e<0&&(e/=1+e);var n=parseFloat(this.start.valueOf()-t.valueOf()),r=parseFloat(this.end.valueOf()-t.valueOf()),i=new Date(this.start.valueOf()-n*e),s=new Date(this.end.valueOf()-r*e);this.applyRange(i,s,t),this.render({animate:this.options.animate&&this.options.animateZoom})},links.Timeline.prototype.move=function(e){var t=parseFloat(this.end.valueOf()-this.start.valueOf()),n=new Date(this.start.valueOf()+t*e),r=new Date(this.end.valueOf()+t*e);this.applyRange(n,r),this.render()},links.Timeline.prototype.applyRange=function(e,t,n){var r=e.valueOf(),i=t.valueOf(),s=i-r,o=this.options,u=31536e6,a=Number(o.intervalMin)||10;a<10&&(a=10);var f=Number(o.intervalMax)||1e4*u;f>1e4*u&&(f=1e4*u),f<a&&(f=a);var l=o.min?o.min.valueOf():undefined,c=o.max?o.max.valueOf():undefined;if(l!=undefined&&c!=undefined){if(l>=c){var h=864e5;c=l+h}f>c-l&&(f=c-l),a>c-l&&(a=c-l)}r>=i&&(i+=864e5);if(s<a){var p=a-s,d=n?(n.valueOf()-r)/s:.5;r-=Math.round(p*d),i+=Math.round(p*(1-d))}if(s>f){var p=s-f,d=n?(n.valueOf()-r)/s:.5;r+=Math.round(p*d),i-=Math.round(p*(1-d))}if(l!=undefined){var p=r-l;p<0&&(r-=p,i-=p)}if(c!=undefined){var p=c-i;p<0&&(r+=p,i+=p)}this.start=new Date(r),this.end=new Date(i)},links.Timeline.prototype.confirmDeleteItem=function(e){this.applyDelete=!0,this.isSelected(e)||this.selectItem(e),this.trigger("delete"),this.applyDelete&&this.deleteItem(e),delete this.applyDelete},links.Timeline.prototype.deleteItem=function(e){if(e>=this.items.length)throw"Cannot delete row, index out of range";this.unselectItem();var t=this.items.splice(e,1)[0];t.deleteDOM();if(this.data)if(google&&google.visualization&&this.data instanceof google.visualization.DataTable)this.data.removeRow(e);else{if(!links.Timeline.isArray(this.data))throw"Cannot delete row from data, unknown data type";this.data.splice(e,1)}this.render()},links.Timeline.prototype.deleteAllItems=function(){this.unselectItem(),this.clearItems(),this.deleteGroups();if(this.data)if(google&&google.visualization&&this.data instanceof google.visualization.DataTable)this.data.removeRows(0,this.data.getNumberOfRows());else{if(!links.Timeline.isArray(this.data))throw"Cannot delete row from data, unknown data type";this.data.splice(0,this.data.length)}this.render()},links.Timeline.prototype.getGroupFromHeight=function(e){var t,n,r=this.groups;if(r){if(this.options.axisOnTop)for(t=r.length-1;t>=0;t--){n=r[t];if(e>n.top)return n}else for(t=0;t<r.length;t++){n=r[t];if(e>n.top)return n}return n}return undefined},links.Timeline.Item=function(e,t){e&&(this.start=e.start,this.end=e.end,this.content=e.content,this.className=e.className,this.editable=e.editable,this.group=e.group,this.start&&(this.end?this.center=(this.start.valueOf()+this.end.valueOf())/2:this.center=this.start.valueOf())),this.top=0,this.left=0,this.width=0,this.height=0,this.lineWidth=0,this.dotWidth=0,this.dotHeight=0;if(t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])},links.Timeline.Item.prototype.repaint=function(e){var t=!1;return this.visible?(this.dom||(this.dom=this.createDOM(),this.changed=!0,t=!0),this.domVisible||this.showDOM(e),this.changed&&(this.updateDOM(),this.changed=!1)):this.domVisible&&this.hideDOM(e),t},links.Timeline.Item.prototype.reflow=function(){return!1},links.Timeline.Item.prototype.getImageUrls=function(e){this.dom&&links.imageloader.filterImageUrls(this.dom,e)},links.Timeline.Item.prototype.select=function(){},links.Timeline.Item.prototype.unselect=function(){},links.Timeline.Item.prototype.createDOM=function(){},links.Timeline.Item.prototype.showDOM=function(e){},links.Timeline.Item.prototype.hideDOM=function(e){},links.Timeline.Item.prototype.updateDOM=function(){},links.Timeline.Item.prototype.deleteDOM=function(){this.hideDOM(),delete this.dom},links.Timeline.Item.prototype.updatePosition=function(e){},links.Timeline.Item.prototype.updateVisible=function(e){},links.Timeline.Item.prototype.setPosition=function(e,t){},links.Timeline.Item.prototype.getRight=function(e){return 0},links.Timeline.ItemBox=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemBox.prototype=new links.Timeline.Item,links.Timeline.ItemBox.prototype.reflow=function(){var e=this.dom,t=e.dot.offsetHeight,n=e.dot.offsetWidth,r=e.line.offsetWidth,i=this.dotHeight!=t||this.dotWidth!=n||this.lineWidth!=r;return this.dotHeight=t,this.dotWidth=n,this.lineWidth=r,i},links.Timeline.ItemBox.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected"),links.Timeline.addClassName(e.line,"timeline-event-selected"),links.Timeline.addClassName(e.dot,"timeline-event-selected")},links.Timeline.ItemBox.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected"),links.Timeline.removeClassName(e.line,"timeline-event-selected"),links.Timeline.removeClassName(e.dot,"timeline-event-selected")},links.Timeline.ItemBox.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute",e.style.left=this.left+"px",e.style.top=this.top+"px";var t=document.createElement("DIV");t.className="timeline-event-content",t.innerHTML=this.content,e.appendChild(t);var n=document.createElement("DIV");n.style.position="absolute",n.style.width="0px",e.line=n;var r=document.createElement("DIV");return r.style.position="absolute",r.style.width="0px",r.style.height="0px",e.dot=r,e},links.Timeline.ItemBox.prototype.showDOM=function(e){e.appendChild(this.dom),e.insertBefore(this.dom.line,e.firstChild),e.appendChild(this.dom.dot),this.domVisible=!0},links.Timeline.ItemBox.prototype.hideDOM=function(){var e=this.dom;if(e){var t=e.parentNode;t&&(t.removeChild(e),t.removeChild(e.line),t.removeChild(e.dot))}this.domVisible=!1},links.Timeline.ItemBox.prototype.updateDOM=function(){if(this.dom){var e=this.dom,t=e.line,n=e.dot;e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-box",t.className="timeline-event timeline-event-line",n.className="timeline-event timeline-event-dot",this.isCluster&&(links.Timeline.addClassName(e,"timeline-event-cluster"),links.Timeline.addClassName(t,"timeline-event-cluster"),links.Timeline.addClassName(n,"timeline-event-cluster")),this.className&&(links.Timeline.addClassName(e,this.className),links.Timeline.addClassName(t,this.className),links.Timeline.addClassName(n,this.className))}},links.Timeline.ItemBox.prototype.updatePosition=function(e){var t=this.dom,n=e.timeToScreen(this.start),r=e.options.axisOnTop,i=e.size.axis.top,s=e.size.axis.height,o=e.options.box&&e.options.box.align?e.options.box.align:undefined;t.style.top=this.top+"px",o=="right"?t.style.left=n-this.width+"px":o=="left"?t.style.left=n+"px":t.style.left=n-this.width/2+"px";var u=t.line,a=t.dot;u.style.left=n-this.lineWidth/2+"px",a.style.left=n-this.dotWidth/2+"px",r?(u.style.top=s+"px",u.style.height=Math.max(this.top-s,0)+"px",a.style.top=s-this.dotHeight/2+"px"):(u.style.top=this.top+this.height+"px",u.style.height=Math.max(i-this.top-this.height,0)+"px",a.style.top=i-this.dotHeight/2+"px")},links.Timeline.ItemBox.prototype.updateVisible=function(e){var t=e.timeToScreen(this.start),n=e.size.contentWidth;this.visible=t+this.width/2>-n&&t-this.width/2<2*n&&!this.cluster},links.Timeline.ItemBox.prototype.setPosition=function(e,t){var n=this.dom;n.style.left=e-this.width/2+"px",n.line.style.left=e-this.lineWidth/2+"px",n.dot.style.left=e-this.dotWidth/2+"px",this.group&&(this.top=this.group.top,n.style.top=this.top+"px")},links.Timeline.ItemBox.prototype.getRight=function(e){var t=e.options.box&&e.options.box.align?e.options.box.align:undefined,n=e.timeToScreen(this.start),r;return t=="right"?r=n:t=="left"?r=n+this.width:r=n+this.width/2,r},links.Timeline.ItemRange=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemRange.prototype=new links.Timeline.Item,links.Timeline.ItemRange.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected")},links.Timeline.ItemRange.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected")},links.Timeline.ItemRange.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");return t.className="timeline-event-content",e.appendChild(t),e},links.Timeline.ItemRange.prototype.showDOM=function(e){e.appendChild(this.dom),this.domVisible=!0},links.Timeline.ItemRange.prototype.hideDOM=function(){var e=this.dom;if(e){var t=e.parentNode;t&&t.removeChild(e)}this.domVisible=!1},links.Timeline.ItemRange.prototype.updateDOM=function(){if(this.dom){var e=this.dom;e.firstChild.innerHTML=this.content,e.className="timeline-event timeline-event-range",this.isCluster&&links.Timeline.addClassName(e,"timeline-event-cluster"),this.className&&links.Timeline.addClassName(e,this.className)}},links.Timeline.ItemRange.prototype.updatePosition=function(e){var t=this.dom,n=e.size.contentWidth,r=e.timeToScreen(this.start),i=e.timeToScreen(this.end);r<-n&&(r=-n),i>2*n&&(i=2*n),t.style.top=this.top+"px",t.style.left=r+"px",t.style.width=Math.max(i-r,1)+"px"},links.Timeline.ItemRange.prototype.updateVisible=function(e){var t=e.timeToScreen(this.start),n=e.timeToScreen(this.end),r=e.size.contentWidth;this.visible=n>-r&&t<2*r&&!this.cluster},links.Timeline.ItemRange.prototype.setPosition=function(e,t){var n=this.dom;n.style.left=e+"px",n.style.width=t-e+"px",this.group&&(this.top=this.group.top,n.style.top=this.top+"px")},links.Timeline.ItemRange.prototype.getRight=function(e){return e.timeToScreen(this.end)},links.Timeline.ItemDot=function(e,t){links.Timeline.Item.call(this,e,t)},links.Timeline.ItemDot.prototype=new links.Timeline.Item,links.Timeline.ItemDot.prototype.reflow=function(){var e=this.dom,t=e.dot.offsetHeight,n=e.dot.offsetWidth,r=e.content.offsetHeight,i=this.dotHeight!=t||this.dotWidth!=n||this.contentHeight!=r;return this.dotHeight=t,this.dotWidth=n,this.contentHeight=r,i},links.Timeline.ItemDot.prototype.select=function(){var e=this.dom;links.Timeline.addClassName(e,"timeline-event-selected")},links.Timeline.ItemDot.prototype.unselect=function(){var e=this.dom;links.Timeline.removeClassName(e,"timeline-event-selected")},links.Timeline.ItemDot.prototype.createDOM=function(){var e=document.createElement("DIV");e.style.position="absolute";var t=document.createElement("DIV");t.className="timeline-event-content",e.appendChild(t);var n=document.createElement("DIV");return n.style.position="absolute",n.style.width="0px",n.style.height="0px",e.appendChild(n),e.content=t,e.dot=n,e},links.Timeline.ItemDot.prototype.showDOM=function(e){e.appendChild(this.dom),this.domVisible=!0},links.Timeline.ItemDot.prototype.hideDOM=function(e){var t=this.dom;if(t){var n=t.parentNode;n&&n.removeChild(t)}this.domVisible=!1},links.Timeline.ItemDot.prototype.updateDOM=function(){if(this.dom){var e=this.dom,t=e.dot;e.firstChild.innerHTML=this.content,t.className="timeline-event timeline-event-dot",this.isCluster&&(links.Timeline.addClassName(e,"timeline-event-cluster"),links.Timeline.addClassName(t,"timeline-event-cluster")),this.className&&(links.Timeline.addClassName(e,this.className),links.Timeline.addClassName(t,this.className))}},links.Timeline.ItemDot.prototype.updatePosition=function(e){var t=this.dom,n=e.timeToScreen(this.start);t.style.top=this.top+"px",t.style.left=n-this.dotWidth/2+"px",t.content.style.marginLeft=1.5*this.dotWidth+"px",t.dot.style.top=(this.height-this.dotHeight)/2+"px"},links.Timeline.ItemDot.prototype.updateVisible=function(e){var t=e.timeToScreen(this.start),n=e.size.contentWidth;this.visible=t+this.width>-n&&t<2*n&&!this.cluster},links.Timeline.ItemDot.prototype.setPosition=function(e,t){var n=this.dom;n.style.left=e-this.dotWidth/2+"px",this.group&&(this.top=this.group.top,n.style.top=this.top+"px")},links.Timeline.ItemDot.prototype.getRight=function(e){return e.timeToScreen(this.start)+this.width},links.Timeline.prototype.getItem=function(e){if(e>=this.items.length)throw"Cannot get item, index out of range";var t=this.items[e],n={};return n.start=new Date(t.start),t.end&&(n.end=new Date(t.end)),n.content=t.content,t.group&&(n.group=this.getGroupName(t.group)),n},links.Timeline.prototype.addItem=function(e){var t=[e];this.addItems(t)},links.Timeline.prototype.addItems=function(e){var t=e,n=this.items;for(var r=0,i=t.length;r<i;r++){var s=e[r];n.push(this.createItem(s));var o=n.length-1;this.updateData(o,s)}this.render({animate:!1})},links.Timeline.prototype.createItem=function(e){var t=e.end?"range":this.options.style,n={start:e.start,end:e.end,content:e.content,className:e.className,editable:e.editable,group:this.getGroup(e.group)},r,i=this.options;i.axisOnTop?r=this.size.axis.height+i.eventMarginAxis+i.eventMargin/2:r=this.size.contentHeight-i.eventMarginAxis-i.eventMargin/2;switch(t){case"box":return new links.Timeline.ItemBox(n,{top:r});case"range":return new links.Timeline.ItemRange(n,{top:r});case"dot":return new links.Timeline.ItemDot(n,{top:r})}return console.log('ERROR: Unknown event style "'+t+'"'),new links.Timeline.Item(n,{top:r})},links.Timeline.prototype.changeItem=function(e,t){var n=this.items[e];if(!n)throw"Cannot change item, index out of range";n.deleteDOM();var r=this.createItem({start:t.hasOwnProperty("start")?t.start:n.start,end:t.hasOwnProperty("end")?t.end:n.end,content:t.hasOwnProperty("content")?t.content:n.content,group:t.hasOwnProperty("group")?t.group:this.getGroupName(n.group)});this.items[e]=r,this.updateData(e,t),this.render({animate:!1}),r.select()},links.Timeline.prototype.deleteGroups=function(){this.groups=[],this.groupIndexes={}},links.Timeline.prototype.getGroup=function(e){var t=this.groups,n=this.groupIndexes,r=undefined,i=n[e];if(i===undefined&&e!==undefined){r={content:e,labelTop:0,lineTop:0},t.push(r),t=t.sort(function(e,t){return e.content>t.content?1:e.content<t.content?-1:0});for(var s=0,o=t.length;s<o;s++)n[t[s].content]=s}else r=t[i];return r},links.Timeline.prototype.getGroupName=function(e){return e?e.content:undefined},links.Timeline.prototype.cancelChange=function(){this.applyChange=!1},links.Timeline.prototype.cancelDelete=function(){this.applyDelete=!1},links.Timeline.prototype.cancelAdd=function(){this.applyAdd=!1},links.Timeline.prototype.setSelection=function(e){if(e!=undefined&&e.length>0){if(e[0].row!=undefined){var t=e[0].row;if(this.items[t]){var n=this.items[t];this.selectItem(t);var r=n.start,i=n.end,s;i!=undefined?s=new Date((i.valueOf()+r.valueOf())/2):s=new Date(r);var o=this.end.valueOf()-this.start.valueOf(),u=new Date(s.valueOf()-o/2),a=new Date(s.valueOf()+o/2);return this.setVisibleChartRange(u,a),!0}}}else this.unselectItem();return!1},links.Timeline.prototype.getSelection=function(){var e=[];return this.selection&&e.push({row:this.selection.index}),e},links.Timeline.prototype.selectItem=function(e){this.unselectItem(),this.selection=undefined;if(this.items[e]!==undefined){var t=this.items[e],n=t.dom;this.selection={index:e,item:n},this.isEditable(t)&&(n.style.cursor="move"),t.select(),this.repaintDeleteButton(),this.repaintDragAreas()}},links.Timeline.prototype.isSelected=function(e){return this.selection&&this.selection.index===e},links.Timeline.prototype.unselectItem=function(){if(this.selection){var e=this.items[this.selection.index];if(e&&e.dom){var t=e.dom;t.style.cursor="",e.unselect()}this.selection=undefined,this.repaintDeleteButton(),this.repaintDragAreas()}},links.Timeline.prototype.stackItems=function(e){if(this.groups.length>0)return;e==undefined&&(e=!1);var t=this.stack;t||(t={},this.stack=t),t.sortedItems=this.stackOrder(this.visibleItems),t.finalItems=this.stackCalculateFinal(t.sortedItems);if(e||t.timer){var n=this,r=function(){var e=n.stackMoveOneStep(t.sortedItems,t.finalItems);n.repaint(),e?delete t.timer:t.timer=setTimeout(r,30)};t.timer||(t.timer=setTimeout(r,30))}else this.stackMoveToFinal(t.sortedItems,t.finalItems)},links.Timeline.prototype.stackCancelAnimation=function(){this.stack&&this.stack.timer&&(clearTimeout(this.stack.timer),delete this.stack.timer)},links.Timeline.prototype.stackOrder=function(e){var t=e.concat([]),n=function(e,t){return e instanceof links.Timeline.ItemRange&&!(t instanceof links.Timeline.ItemRange)?-1:!(e instanceof links.Timeline.ItemRange)&&t instanceof links.Timeline.ItemRange?1:e.left-t.left};return t.sort(n),t},links.Timeline.prototype.stackCalculateFinal=function(e){var t,n,r=this.size,i=r.axis.top,s=r.axis.height,o=this.options,u=o.axisOnTop,a=o.eventMargin,f=o.eventMarginAxis,l=[];for(t=0,n=e.length;t<n;t++){var c=e[t],h,p,d,v,m=c.height,g=c.width;u?h=s+f+a/2:h=i-m-f-a/2,v=h+m;if(c instanceof links.Timeline.ItemBox)p=this.timeToScreen(c.start)-g/2,d=p+g;else if(c instanceof links.Timeline.ItemRange||c instanceof links.Timeline.ItemDot)p=this.timeToScreen(c.start),d=c.end?this.timeToScreen(c.end):p+g;l[t]={left:p,top:h,right:d,bottom:v,height:m,item:c}}if(this.options.stackEvents)for(t=0,n=l.length;t<n;t++){var y=l[t],b=null;do b=this.stackItemsCheckOverlap(l,t,0,t-1),b!=null&&(u?y.top=b.top+b.height+a:y.top=b.top-y.height-a,y.bottom=y.top+y.height);while(b)}return l},links.Timeline.prototype.stackMoveOneStep=function(e,t){var n=!0;for(i=0,iMax=e.length;i<iMax;i++){var r=t[i],s=r.item,o=parseInt(s.top),u=parseInt(r.top),a=u-o;if(a){var f=u==o?0:u>o?1:-1;Math.abs(a)>4&&(f=a/4);var l=parseInt(o+f);l!=u&&(n=!1),s.top=l,s.bottom=s.top+s.height}else s.top=r.top,s.bottom=r.bottom;s.left=r.left,s.right=r.right}return n},links.Timeline.prototype.stackMoveToFinal=function(e,t){for(i=0,iMax=e.length;i<iMax;i++){var n=e[i],r=t[i];n.left=r.left,n.top=r.top,n.right=r.right,n.bottom=r.bottom}},links.Timeline.prototype.stackItemsCheckOverlap=function(e,t,n,r){var i=this.options.eventMargin,s=this.collision,o=e[t];for(var u=r;u>=n;u--){var a=e[u];if(s(o,a,i)&&u!=t)return a}return undefined},links.Timeline.prototype.collision=function(e,t,n){return n==undefined&&(n=0),e.left-n<t.right&&e.right+n>t.left&&e.top-n<t.bottom&&e.bottom+n>t.top},links.Timeline.prototype.trigger=function(e){var t=null;switch(e){case"rangechange":case"rangechanged":t={start:new Date(this.start),end:new Date(this.end)};break;case"timechange":case"timechanged":t={time:new Date(this.customTime)}}links.events.trigger(this,e,t),google&&google.visualization&&google.visualization.events.trigger(this,e,t)},links.Timeline.prototype.filterItems=function(){var e,t=this,n=this.items,r=this.size,i=r.contentWidth,s=[];this.visibleItems=s;for(var o=0,u=n.length;o<u;o++){var a=n[o];a.updateVisible(this),a.visible&&s.push(a)}var f=this.clusterFactory.getClusters(this.conversion.factor);f.forEach(function(n){e=t.timeToScreen(n.start),n.visible=e+n.width/2>-i&&e-n.width/2<2*i,n.visible&&s.push(n)})},links.Timeline.ClusterFactory=function(e){this.timeline=e,this.clear()},links.Timeline.ClusterFactory.prototype.clear=function(){this.clearCache(),this.sortedItems=[]},links.Timeline.ClusterFactory.prototype.clearCache=function(){this.cache={},this.cacheLevel=-1,this.cache[this.cacheLevel]=[],this.cacheValid=!0},links.Timeline.ClusterFactory.prototype.invalidateCache=function(){this.cacheValid=!1},links.Timeline.ClusterFactory.prototype.setData=function(e){e=e||[];var t={};this.groups=t,e.forEach(function(e){var n=e.group?e.group.content:"",r=t[n];r||(r=[],t[n]=r),r.push(e)});for(var n in t)t.hasOwnProperty(n)&&t[n].sort(function(e,t){return e.center-t.center})},links.Timeline.ClusterFactory.prototype.getClusters=function(e){var t=-1,n=2,r=0,i=5;e>0&&(t=Math.round(Math.log(100/e)/Math.log(n)),r=Math.pow(n,t),this.timeline.groups&&this.timeline.groups.length&&(r*=4)),!this.cacheValid&&t!=this.cacheLevel&&(this.clearCache(),console.log("cache cleared...")),this.cacheLevel=t;var s=this.cache[t];if(!s){s=[];for(var o in this.groups)if(this.groups.hasOwnProperty(o)){var u=this.groups[o],a=u.length,f=0;while(f<a){var l=u[f],c=1,h=f-1;while(h>=0&&l.center-u[h].center<r/2)u[h].cluster||c++,h--;var p=f+1;while(p<u.length&&u[p].center-l.center<r/2)c++,p++;var d=s.length-1;while(d>=0&&l.center-s[d].center<r/2)l.group==s[d].group&&c++,d--;if(c>i){var v=c-i+1,m=[],g=undefined,y=undefined,b=undefined,w=!1,E=0,S=f;while(m.length<v&&S<u.length){var x=u[S],T=x.start.valueOf(),N=x.end?x.end.valueOf():x.start.valueOf();m.push(x),E?g=E/(E+1)*g+1/(E+1)*x.center:g=x.center,y=y!=undefined?Math.min(y,T):T,b=b!=undefined?Math.max(b,N):N,w=w||x instanceof links.Timeline.ItemRange,E++,S++}var C,k="Cluster containing "+E+" events. Zoom in to see the individual events.",L='<div title="'+k+'">'+E+" events</div>",A=l.group?l.group.content:undefined;w?C=this.timeline.createItem({start:new Date(y),end:new Date(b),content:L,group:A}):C=this.timeline.createItem({start:new Date(g),content:L,group:A}),C.isCluster=!0,C.items=m,C.items.forEach(function(e){e.cluster=C}),s.push(C),f+=v}else delete l.cluster,f+=1}}this.cache[t]=s}return s},links.events=links.events||{listeners:[],indexOf:function(e){var t=this.listeners;for(var n=0,r=this.listeners.length;n<r;n++){var i=t[n];if(i&&i.object==e)return n}return-1},addListener:function(e,t,n){var r=this.indexOf(e),i=this.listeners[r];i||(i={object:e,events:{}},this.listeners.push(i));var s=i.events[t];s||(s=[],i.events[t]=s),s.indexOf(n)==-1&&s.push(n)},removeListener:function(e,t,n){var r=this.indexOf(e),i=this.listeners[r];if(i){var s=i.events[t];if(s){var r=s.indexOf(n);r!=-1&&s.splice(r,1),s.length==0&&delete i.events[t]}var o=0,u=i.events;for(var a in u)u.hasOwnProperty(a)&&o++;o==0&&delete this.listeners[r]}},removeAllListeners:function(){this.listeners=[]},trigger:function(e,t,n){var r=this.indexOf(e),i=this.listeners[r];if(i){var s=i.events[t];if(s)for(var o=0,u=s.length;o<u;o++)s[o](n)}}},links.Timeline.StepDate=function(e,t,n){this.current=new Date,this._start=new Date,this._end=new Date,this.autoScale=!0,this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=1,this.setRange(e,t,n)},links.Timeline.StepDate.SCALE={MILLISECOND:1,SECOND:2,MINUTE:3,HOUR:4,DAY:5,WEEKDAY:6,MONTH:7,YEAR:8},links.Timeline.StepDate.prototype.setRange=function(e,t,n){if(isNaN(e)||isNaN(t))return;this._start=e!=undefined?new Date(e):new Date,this._end=t!=undefined?new Date(t):new Date,this.autoScale&&this.setMinimumStep(n)},links.Timeline.StepDate.prototype.start=function(){this.current=new Date(this._start),this.roundToMinor()},links.Timeline.StepDate.prototype.roundToMinor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.step*Math.floor(this.current.getFullYear()/this.step)),this.current.setMonth(0);case links.Timeline.StepDate.SCALE.MONTH:this.current.setDate(1);case links.Timeline.StepDate.SCALE.DAY:case links.Timeline.StepDate.SCALE.WEEKDAY:this.current.setHours(0);case links.Timeline.StepDate.SCALE.HOUR:this.current.setMinutes(0);case links.Timeline.StepDate.SCALE.MINUTE:this.current.setSeconds(0);case links.Timeline.StepDate.SCALE.SECOND:this.current.setMilliseconds(0)}if(this.step!=1)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.setMilliseconds(this.current.getMilliseconds()-this.current.getMilliseconds()%this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()-this.current.getSeconds()%this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()-this.current.getMinutes()%this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()-this.current.getHours()%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()-1-(this.current.getDate()-1)%this.step+1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()-this.current.getMonth()%this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()-this.current.getFullYear()%this.step);break;default:}},links.Timeline.StepDate.prototype.end=function(){return this.current.getTime()>this._end.getTime()},links.Timeline.StepDate.prototype.next=function(){var e=this.current.getTime();if(this.current.getMonth()<6)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.getTime()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current=new Date(this.current.getTime()+this.step*1e3);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current=new Date(this.current.getTime()+this.step*1e3*60);break;case links.Timeline.StepDate.SCALE.HOUR:this.current=new Date(this.current.getTime()+this.step*1e3*60*60);var t=this.current.getHours();this.current.setHours(t-t%this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step);break;default:}else switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current=new Date(this.current.getTime()+this.step);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.setSeconds(this.current.getSeconds()+this.step);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.setMinutes(this.current.getMinutes()+this.step);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.setHours(this.current.getHours()+this.step);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.setDate(this.current.getDate()+this.step);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.setMonth(this.current.getMonth()+this.step);break;case links.Timeline.StepDate.SCALE.YEAR:this.current.setFullYear(this.current.getFullYear()+this.step);break;default:}if(this.step!=1)switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:this.current.getMilliseconds()<this.step&&this.current.setMilliseconds(0);break;case links.Timeline.StepDate.SCALE.SECOND:this.current.getSeconds()<this.step&&this.current.setSeconds(0);break;case links.Timeline.StepDate.SCALE.MINUTE:this.current.getMinutes()<this.step&&this.current.setMinutes(0);break;case links.Timeline.StepDate.SCALE.HOUR:this.current.getHours()<this.step&&this.current.setHours(0);break;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:this.current.getDate()<this.step+1&&this.current.setDate(1);break;case links.Timeline.StepDate.SCALE.MONTH:this.current.getMonth()<this.step&&this.current.setMonth(0);break;case links.Timeline.StepDate.SCALE.YEAR:break;default:}this.current.getTime()==e&&(this.current=new Date(this._end))},links.Timeline.StepDate.prototype.getCurrent=function(){return this.current},links.Timeline.StepDate.prototype.setScale=function(e,t){this.scale=e,t>0&&(this.step=t),this.autoScale=!1},links.Timeline.StepDate.prototype.setAutoScale=function(e){this.autoScale=e},links.Timeline.StepDate.prototype.setMinimumStep=function(e){if(e==undefined)return;var t=31104e6,n=2592e6,r=864e5,i=36e5,s=6e4,o=1e3,u=1;t*1e3>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=1e3),t*500>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=500),t*100>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=100),t*50>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=50),t*10>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=10),t*5>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=5),t>e&&(this.scale=links.Timeline.StepDate.SCALE.YEAR,this.step=1),n*3>e&&(this.scale=links.Timeline.StepDate.SCALE.MONTH,this.step=3),n>e&&(this.scale=links.Timeline.StepDate.SCALE.MONTH,this.step=1),r*5>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=5),r*2>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=2),r>e&&(this.scale=links.Timeline.StepDate.SCALE.DAY,this.step=1),r/2>e&&(this.scale=links.Timeline.StepDate.SCALE.WEEKDAY,this.step=1),i*4>e&&(this.scale=links.Timeline.StepDate.SCALE.HOUR,this.step=4),i>e&&(this.scale=links.Timeline.StepDate.SCALE.HOUR,this.step=1),s*15>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=15),s*10>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=10),s*5>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=5),s>e&&(this.scale=links.Timeline.StepDate.SCALE.MINUTE,this.step=1),o*15>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=15),o*10>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=10),o*5>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=5),o>e&&(this.scale=links.Timeline.StepDate.SCALE.SECOND,this.step=1),u*200>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=200),u*100>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=100),u*50>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=50),u*10>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=10),u*5>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=5),u>e&&(this.scale=links.Timeline.StepDate.SCALE.MILLISECOND,this.step=1)},links.Timeline.StepDate.prototype.snap=function(e){if(this.scale==links.Timeline.StepDate.SCALE.YEAR){var t=e.getFullYear()+Math.round(e.getMonth()/12);e.setFullYear(Math.round(t/this.step)*this.step),e.setMonth(0),e.setDate(0),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.MONTH)e.getDate()>15?(e.setDate(1),e.setMonth(e.getMonth()+1)):e.setDate(1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);else if(this.scale==links.Timeline.StepDate.SCALE.DAY||this.scale==links.Timeline.StepDate.SCALE.WEEKDAY){switch(this.step){case 5:case 2:e.setHours(Math.round(e.getHours()/24)*24);break;default:e.setHours(Math.round(e.getHours()/12)*12)}e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.HOUR){switch(this.step){case 4:e.setMinutes(Math.round(e.getMinutes()/60)*60);break;default:e.setMinutes(Math.round(e.getMinutes()/30)*30)}e.setSeconds(0),e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.MINUTE){switch(this.step){case 15:case 10:e.setMinutes(Math.round(e.getMinutes()/5)*5),e.setSeconds(0);break;case 5:e.setSeconds(Math.round(e.getSeconds()/60)*60);break;default:e.setSeconds(Math.round(e.getSeconds()/30)*30)}e.setMilliseconds(0)}else if(this.scale==links.Timeline.StepDate.SCALE.SECOND)switch(this.step){case 15:case 10:e.setSeconds(Math.round(e.getSeconds()/5)*5),e.setMilliseconds(0);break;case 5:e.setMilliseconds(Math.round(e.getMilliseconds()/1e3)*1e3);break;default:e.setMilliseconds(Math.round(e.getMilliseconds()/500)*500)}else if(this.scale==links.Timeline.StepDate.SCALE.MILLISECOND){var n=this.step>5?this.step/2:1;e.setMilliseconds(Math.round(e.getMilliseconds()/n)*n)}},links.Timeline.StepDate.prototype.isMajor=function(){switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return this.current.getMilliseconds()==0;case links.Timeline.StepDate.SCALE.SECOND:return this.current.getSeconds()==0;case links.Timeline.StepDate.SCALE.MINUTE:return this.current.getHours()==0&&this.current.getMinutes()==0;case links.Timeline.StepDate.SCALE.HOUR:return this.current.getHours()==0;case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return this.current.getDate()==1;case links.Timeline.StepDate.SCALE.MONTH:return this.current.getMonth()==0;case links.Timeline.StepDate.SCALE.YEAR:return!1;default:return!1}},links.Timeline.StepDate.prototype.getLabelMinor=function(e){var t=["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"],n=["zo","ma","di","wo","do","vr","za"];e==undefined&&(e=this.current);switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return String(e.getMilliseconds());case links.Timeline.StepDate.SCALE.SECOND:return String(e.getSeconds());case links.Timeline.StepDate.SCALE.MINUTE:return this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2);case links.Timeline.StepDate.SCALE.HOUR:return this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2);case links.Timeline.StepDate.SCALE.WEEKDAY:return n[e.getDay()]+" "+e.getDate();case links.Timeline.StepDate.SCALE.DAY:return String(e.getDate());case links.Timeline.StepDate.SCALE.MONTH:return t[e.getMonth()];case links.Timeline.StepDate.SCALE.YEAR:return String(e.getFullYear());default:return""}},links.Timeline.StepDate.prototype.getLabelMajor=function(e){var t=["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],n=["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"];e==undefined&&(e=this.current);switch(this.scale){case links.Timeline.StepDate.SCALE.MILLISECOND:return this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2)+":"+this.addZeros(e.getSeconds(),2);case links.Timeline.StepDate.SCALE.SECOND:return e.getDate()+" "+t[e.getMonth()]+" "+this.addZeros(e.getHours(),2)+":"+this.addZeros(e.getMinutes(),2);case links.Timeline.StepDate.SCALE.MINUTE:return n[e.getDay()]+" "+e.getDate()+" "+t[e.getMonth()]+" "+e.getFullYear();case links.Timeline.StepDate.SCALE.HOUR:return n[e.getDay()]+" "+e.getDate()+" "+t[e.getMonth()]+" "+e.getFullYear();case links.Timeline.StepDate.SCALE.WEEKDAY:case links.Timeline.StepDate.SCALE.DAY:return t[e.getMonth()]+" "+e.getFullYear();case links.Timeline.StepDate.SCALE.MONTH:return String(e.getFullYear());default:return""}},links.Timeline.StepDate.prototype.addZeros=function(e,t){var n=""+e;while(n.length<t)n="0"+n;return n},links.imageloader=function(){function n(t){if(e[t]==1)return!0;var n=new Image;return n.src=t,n.complete?!0:!1}function r(e){return t[e]!=undefined}function i(i,s,o){o==undefined&&(o=!0);if(n(i)){o&&s(i);return}if(r(i)&&!o)return;var u=t[i];if(!u){var a=new Image;a.src=i,u=[],t[i]=u,a.onload=function(n){e[i]=!0,delete t[i];for(var r=0;r<u.length;r++)u[r](i)}}u.indexOf(s)==-1&&u.push(s)}function s(e,t,r){var s=[];e.forEach(function(e){n(e)||s.push(e)});if(s.length){var o=s.length;s.forEach(function(e){i(e,function(){o--,o==0&&t()},r)})}else r&&t()}function o(e,t){var n=e.firstChild;while(n){if(n.tagName=="IMG"){var r=n.src;t.indexOf(r)==-1&&t.push(r)}o(n,t),n=n.nextSibling}}var e={},t={};return{isLoaded:n,isLoading:r,load:i,loadAll:s,filterImageUrls:o}}(),links.Timeline.addEventListener=function(e,t,n,r){e.addEventListener?(r===undefined&&(r=!1),t==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.addEventListener(t,n,r)):e.attachEvent("on"+t,n)},links.Timeline.removeEventListener=function(e,t,n,r){e.removeEventListener?(r===undefined&&(r=!1),t==="mousewheel"&&navigator.userAgent.indexOf("Firefox")>=0&&(t="DOMMouseScroll"),e.removeEventListener(t,n,r)):e.detachEvent("on"+t,n)},links.Timeline.getTarget=function(e){e||(e=window.event);var t;return e.target?t=e.target:e.srcElement&&(t=e.srcElement),t.nodeType!==undefined&&t.nodeType==3&&(t=t.parentNode),t},links.Timeline.stopPropagation=function(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},links.Timeline.preventDefault=function(e){e||(e=window.event),e.preventDefault?e.preventDefault():e.returnValue=!1},links.Timeline.getAbsoluteLeft=function(e){var t=0;while(e!=null)t+=e.offsetLeft,t-=e.scrollLeft,e=e.offsetParent;return!document.body.scrollLeft&&window.pageXOffset&&(t-=window.pageXOffset),t},links.Timeline.getAbsoluteTop=function(e){var t=0;while(e!=null)t+=e.offsetTop,t-=e.scrollTop,e=e.offsetParent;return!document.body.scrollTop&&window.pageYOffset&&(t-=window.pageYOffset),t},links.Timeline.addClassName=function(e,t){var n=e.className.split(" ");n.indexOf(t)==-1&&(n.push(t),e.className=n.join(" "))},links.Timeline.removeClassName=function(e,t){var n=e.className.split(" "),r=n.indexOf(t);r!=-1&&(n.splice(r,1),e.className=n.join(" "))},links.Timeline.isArray=function(e){return e instanceof Array?!0:Object.prototype.toString.call(e)==="[object Array]"};