angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/}}).directive("uiMask",["uiMaskConfig","$parse",function(e,t){return{priority:100,require:"ngModel",restrict:"A",compile:function(){var r=e;return function(n,i,s,o){function x(e){return angular.isDefined(e)?(F(e),u?(O(),M(),!0):A()):A()}function T(e){if(!angular.isDefined(e))return;c=e,u&&U()}function N(e){return u?(d=P(e||""),m=D(d),o.$setValidity("mask",m),m&&d.length?H(d):undefined):e}function C(e){return u?(d=P(e||""),m=D(d),o.$viewValue=d.length?H(d):"",o.$setValidity("mask",m),d===""&&s.required&&o.$setValidity("required",!1),m?d:undefined):e}function A(){return u=!1,_(),angular.isDefined(g)?i.attr("placeholder",g):i.removeAttr("placeholder"),angular.isDefined(y)?i.attr("maxlength",y):i.removeAttr("maxlength"),i.val(o.$modelValue),o.$viewValue=o.$modelValue,!1}function O(){d=w=P(o.$modelValue||""),v=b=H(d),m=D(d);var e=m&&d.length?v:"";s.maxlength&&i.attr("maxlength",f[f.length-1]*2),i.attr("placeholder",c),i.val(e),o.$viewValue=e}function M(){if(a)return;i.bind("blur",I),i.bind("mousedown mouseup",q),i.bind("input keyup click focus",U),a=!0}function _(){if(!a)return;i.unbind("blur",I),i.unbind("mousedown",q),i.unbind("mouseup",q),i.unbind("input",U),i.unbind("keyup",U),i.unbind("click",U),i.unbind("focus",U),a=!1}function D(e){return e.length?e.length>=p:!0}function P(e){var t="",n=l.slice();return e=e.toString(),angular.forEach(h,function(t){e=e.replace(t,"")}),angular.forEach(e.split(""),function(e){n.length&&n[0].test(e)&&(t+=e,n.shift())}),t}function H(e){var t="",n=f.slice();return angular.forEach(c.split(""),function(r,i){e.length&&i===n[0]?(t+=e.charAt(0)||"_",e=e.substr(1),n.shift()):t+=r}),t}function B(e){var t=s.placeholder;return typeof t!="undefined"&&t[e]?t[e]:"_"}function j(){return c.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_")}function F(e){var t=0;f=[],l=[],c="";if(typeof e=="string"){p=0;var n=!1,r=e.split("");angular.forEach(r,function(e,r){k.maskDefinitions[e]?(f.push(t),c+=B(r),l.push(k.maskDefinitions[e]),t++,n||p++):e==="?"?n=!0:(c+=e,t++)})}f.push(f.slice().pop()+1),h=j(),u=f.length>1?!0:!1}function I(){E=0,S=0;if(!m||d.length===0)v="",i.val(""),n.$apply(function(){o.$setViewValue("")})}function q(e){e.type==="mousedown"?i.bind("mouseout",R):i.unbind("mouseout",R)}function R(){S=V(this),i.unbind("mouseout",R)}function U(e){e=e||{};var t=e.which,r=e.type;if(t===16||t===91)return;var s=i.val(),u=b,a,l=P(s),c=w,h=!1,p=W(this)||0,d=E||0,v=p-d,m=f[0],g=f[l.length]||f.slice().shift(),y=S||0,x=V(this)>0,T=y>0,N=s.length>u.length||y&&s.length>u.length-y,C=s.length<u.length||y&&s.length===u.length-y,k=t>=37&&t<=40&&e.shiftKey,L=t===37,A=t===8||r!=="keyup"&&C&&v===-1,O=t===46||r!=="keyup"&&C&&v===0&&!T,M=(L||A||r==="click")&&p>m;S=V(this);if(k||x&&(r==="click"||r==="keyup"))return;if(r==="input"&&C&&!T&&l===c){while(A&&p>m&&!z(p))p--;while(O&&p<g&&f.indexOf(p)===-1)p++;var _=f.indexOf(p);l=l.substring(0,_)+l.substring(_+1),h=!0}a=H(l),b=a,w=l,i.val(a),h&&n.$apply(function(){o.$setViewValue(l)}),N&&p<=m&&(p=m+1),M&&p--,p=p>g?g:p<m?m:p;while(!z(p)&&p>m&&p<g)p+=M?-1:1;(M&&p<g||N&&!z(d))&&p++,E=p,X(this,p)}function z(e){return f.indexOf(e)>-1}function W(e){if(!e)return 0;if(e.selectionStart!==undefined)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();return t.moveStart("character",e.value?-e.value.length:0),t.text.length}return 0}function X(e,t){if(!e)return 0;if(e.offsetWidth===0||e.offsetHeight===0)return;if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}function V(e){return e?e.selectionStart!==undefined?e.selectionEnd-e.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var u=!1,a=!1,f,l,c,h,p,d,v,m,g=s.placeholder,y=s.maxlength,b,w,E,S,k={};s.uiOptions?(k=n.$eval("["+s.uiOptions+"]"),angular.isObject(k[0])&&(k=function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]?angular.extend(t[n],e[n]):t[n]=angular.copy(e[n]));return t}(r,k[0]))):k=r,s.$observe("uiMask",x),s.$observe("placeholder",T);var L=!1;s.$observe("modelViewValue",function(e){e==="true"&&(L=!0)}),n.$watch(s.ngModel,function(e){if(L&&e){var r=t(s.ngModel);r.assign(n,o.$viewValue)}}),o.$formatters.push(N),o.$parsers.push(C),i.bind("mousedown mouseup",q),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Infinity&&r!==-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1})}}}}]);