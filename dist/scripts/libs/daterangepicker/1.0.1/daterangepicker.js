/**
* @version: 1.0.1
* @author: Dan Grossman http://www.dangrossman.info/
* @date: 2012-08-20
* @copyright: Copyright (c) 2012 Dan Grossman. All rights reserved.
* @license: Licensed under Apache License v2.0. See http://www.apache.org/licenses/LICENSE-2.0
* @website: http://www.improvely.com/
*/

!function(e){var t=function(t,n,r){var i=typeof n=="object",s;this.startDate=Date.create("today"),this.endDate=Date.create("today"),this.minDate=!1,this.maxDate=!1,this.changed=!1,this.cleared=!1,this.ranges={},this.opens="right",this.cb=function(){},this.format="{dd}-{MM}-{yyyy}",this.separator=" / ",this.showWeekNumbers=!1,this.buttonClasses=["btn-success"],this.locale={applyLabel:"Apply",clearLabel:"Clear",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:0},s=this.locale,this.leftCalendar={month:Date.create("today").set({day:1,month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),calendar:Array()},this.rightCalendar={month:Date.create("today").set({day:1,month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),calendar:Array()},this.element=e(t),this.element.hasClass("pull-right")&&(this.opens="left"),this.element.is("input")?this.element.on({click:e.proxy(this.show,this),focus:e.proxy(this.show,this)}):this.element.on("click",e.proxy(this.show,this)),i&&typeof n.locale=="object"&&e.each(s,function(e,t){s[e]=n.locale[e]||t});var o='<div class="daterangepicker dropdown-menu"><div class="calendar left"></div><div class="calendar right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input" style="float: left"><label for="daterangepicker_start">'+this.locale.fromLabel+"</label>"+'<input class="input-mini" type="text" name="daterangepicker_start" value="" disabled="disabled" />'+"</div>"+'<div class="daterangepicker_end_input" style="float: left; padding-left: 11px">'+'<label for="daterangepicker_end">'+this.locale.toLabel+"</label>"+'<input class="input-mini" type="text" name="daterangepicker_end" value="" disabled="disabled" />'+"</div>"+'<button class="btn btn-small btn-success applyBtn" disabled="disabled">'+this.locale.applyLabel+"</button>&nbsp;"+'<button class="btn btn-small clearBtn">'+this.locale.clearLabel+"</button>"+"</div>"+"</div>"+"</div>";this.container=e(o).appendTo("body");if(i){typeof n.format=="string"&&(this.format=n.format),typeof n.separator=="string"&&(this.separator=n.separator),typeof n.startDate=="string"&&(this.startDate=Date.create(n.startDate)),typeof n.endDate=="string"&&(this.endDate=Date.create(n.endDate)),typeof n.minDate=="string"&&(this.minDate=Date.create(n.minDate)),typeof n.maxDate=="string"&&(this.maxDate=Date.create(n.maxDate)),typeof n.startDate=="object"&&(this.startDate=n.startDate),typeof n.endDate=="object"&&(this.endDate=n.endDate),typeof n.minDate=="object"&&(this.minDate=n.minDate),typeof n.maxDate=="object"&&(this.maxDate=n.maxDate);if(typeof n.ranges=="object"){for(var u in n.ranges){var a=n.ranges[u][0],f=n.ranges[u][1];typeof a=="string"&&(a=Date.create(a)),typeof f=="string"&&(f=Date.create(f)),this.minDate&&a<this.minDate&&(a=this.minDate),this.maxDate&&f>this.maxDate&&(f=this.maxDate);if(this.minDate&&f<this.minDate||this.maxDate&&a>this.maxDate)continue;this.ranges[u]=[a,f]}var l="<ul>";for(var u in this.ranges)l+="<li>"+u+"</li>";l+="<li>"+this.locale.customRangeLabel+"</li>",l+="</ul>",this.container.find(".ranges").prepend(l)}if(typeof n.locale=="object"&&typeof n.locale.firstDay=="number"){this.locale.firstDay=n.locale.firstDay;var c=n.locale.firstDay;while(c>0)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),c--}typeof n.opens=="string"&&(this.opens=n.opens),typeof n.showWeekNumbers=="boolean"&&(this.showWeekNumbers=n.showWeekNumbers),typeof n.buttonClasses=="string"&&(this.buttonClasses=[n.buttonClasses]),typeof n.buttonClasses=="object"&&(this.buttonClasses=n.buttonClasses)}var h=this.container;e.each(this.buttonClasses,function(e,t){h.find("button").addClass(t)});if(this.opens=="right"){var p=this.container.find(".calendar.left"),d=this.container.find(".calendar.right");p.removeClass("left").addClass("right"),d.removeClass("right").addClass("left")}(typeof n=="undefined"||typeof n.ranges=="undefined")&&this.container.find(".calendar").show(),typeof r=="function"&&(this.cb=r),this.container.addClass("opens"+this.opens),this.container.on("mousedown",e.proxy(this.mousedown,this)),this.container.find(".calendar").on("click",".prev",e.proxy(this.clickPrev,this)),this.container.find(".calendar").on("click",".next",e.proxy(this.clickNext,this)),this.container.find(".ranges").on("click","button.applyBtn",e.proxy(this.clickApply,this)),this.container.find(".ranges").on("click","button.clearBtn",e.proxy(this.clickClear,this)),this.container.find(".calendar").on("click","td.available",e.proxy(this.clickDate,this)),this.container.find(".calendar").on("mouseenter","td.available",e.proxy(this.enterDate,this)),this.container.find(".calendar").on("mouseleave","td.available",e.proxy(this.updateView,this)),this.container.find(".ranges").on("click","li",e.proxy(this.clickRange,this)),this.container.find(".ranges").on("mouseenter","li",e.proxy(this.enterRange,this)),this.container.find(".ranges").on("mouseleave","li",e.proxy(this.updateView,this)),this.element.on("keyup",e.proxy(this.updateFromControl,this)),this.updateView(),this.updateCalendars()};t.prototype={constructor:t,mousedown:function(e){e.stopPropagation(),e.preventDefault()},updateView:function(){this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.format)),this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.format)),this.startDate.is(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled")},updateFromControl:function(){if(!this.element.is("input"))return;var e=this.element.val().split(this.separator),t=Date.create(e[0]),n=Date.create(e[1]);if(t==null||n==null)return;if(n.isBefore(t))return;this.startDate=t,this.endDate=n,this.updateView(),this.cb(this.startDate,this.endDate),this.updateCalendars()},notify:function(){this.cleared||this.updateView(),this.element.is("input")&&this.element.val(this.cleared?"":this.startDate.format(this.format)+this.separator+this.endDate.format(this.format));var e=this.cleared?null:this.startDate,t=this.cleared?null:this.endDate;this.cleared=!1,this.cb(e,t)},move:function(){this.opens=="left"?this.container.css({top:this.element.offset().top+this.element.outerHeight(),right:e(window).width()-this.element.offset().left-this.element.outerWidth(),left:"auto"}):this.container.css({top:this.element.offset().top+this.element.outerHeight(),left:this.element.offset().left,right:"auto"})},show:function(t){this.container.show(),this.move(),t&&(t.stopPropagation(),t.preventDefault()),this.changed=!1,this.element.trigger("shown",{target:t.target,picker:this}),e(document).on("mousedown",e.proxy(this.hide,this))},hide:function(t){this.container.hide(),e(document).off("mousedown",this.hide),this.changed&&(this.changed=!1,this.notify())},enterRange:function(e){var t=e.target.innerHTML;if(t==this.locale.customRangeLabel)this.updateView();else{var n=this.ranges[t];this.container.find("input[name=daterangepicker_start]").val(n[0].format(this.format)),this.container.find("input[name=daterangepicker_end]").val(n[1].format(this.format))}},clickRange:function(e){var t=e.target.innerHTML;if(t==this.locale.customRangeLabel)this.container.find(".calendar").show();else{var n=this.ranges[t];this.startDate=n[0],this.endDate=n[1],this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),this.updateCalendars(),this.changed=!0,this.container.find(".calendar").hide(),this.hide()}},clickPrev:function(t){var n=e(t.target).parents(".calendar");n.hasClass("left")?this.leftCalendar.month.addMonths(-1):this.rightCalendar.month.addMonths(-1),this.updateCalendars()},clickNext:function(t){var n=e(t.target).parents(".calendar");n.hasClass("left")?this.leftCalendar.month.addMonths(1):this.rightCalendar.month.addMonths(1),this.updateCalendars()},enterDate:function(t){var n=e(t.target).attr("title"),r=n.substr(1,1),i=n.substr(3,1),s=e(t.target).parents(".calendar");s.hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[r][i].format(this.format)):this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[r][i].format(this.format))},clickDate:function(t){var n=e(t.target).attr("title"),r=n.substr(1,1),i=n.substr(3,1),s=e(t.target).parents(".calendar");s.hasClass("left")?(startDate=this.leftCalendar.calendar[r][i],endDate=this.endDate,this.element.trigger("clicked",{dir:"left",picker:this})):(startDate=this.startDate,endDate=this.rightCalendar.calendar[r][i],this.element.trigger("clicked",{dir:"right",picker:this})),s.find("td").removeClass("active");if(startDate.is(endDate)||startDate.isBefore(endDate)){e(t.target).addClass("active");if(!startDate.is(this.startDate)||!endDate.is(this.endDate))this.changed=!0;this.startDate=startDate,this.endDate=endDate}else startDate.isAfter(endDate)&&(e(t.target).addClass("active"),this.changed=!0,this.startDate=startDate,this.endDate=startDate.clone().addDays(1));this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),this.updateCalendars()},clickApply:function(e){this.hide()},clickClear:function(e){this.changed=!0,this.cleared=!0,this.hide()},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.getMonth(),this.leftCalendar.month.getFullYear()),this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.getMonth(),this.rightCalendar.month.getFullYear()),this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate)),this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate)),this.element.trigger("updated",this)},buildCalendar:function(e,t){var n=Date.create("today").set({day:1,month:e,year:t}),r=n.clone().addDays(-1).getMonth(),i=n.clone().addDays(-1).getFullYear(),s=this.getDaysInMonth(t,e),o=this.getDaysInMonth(i,r),u=n.getDay(),a=Array();for(var f=0;f<6;f++)a[f]=Array();var l=o-u+this.locale.firstDay+1;l>o&&(l-=7),u==this.locale.firstDay&&(l=o-6);var c=Date.create("today").set({day:l,month:r,year:i});for(var f=0,h=0,p=0;f<42;f++,h++,c=c.clone().addDays(1))f>0&&h%7==0&&(h=0,p++),a[p][h]=c;return a},renderCalendar:function(t,n,r,i){var s='<table class="table-condensed">';s+="<thead>",s+="<tr>",this.showWeekNumbers&&(s+="<th></th>"),!r||r<t[1][1]?s+='<th class="prev available"><i class="icon-arrow-left"></i></th>':s+="<th></th>",s+='<th colspan="5" style="width: auto">'+this.locale.monthNames[t[1][1].getMonth()]+t[1][1].format(" {yyyy}")+"</th>",!i||i>t[1][1]?s+='<th class="next available"><i class="icon-arrow-right"></i></th>':s+="<th></th>",s+="</tr>",s+="<tr>",this.showWeekNumbers&&(s+='<th class="week">'+this.locale.weekLabel+"</th>"),e.each(this.locale.daysOfWeek,function(e,t){s+="<th>"+t+"</th>"}),s+="</tr>",s+="</thead>",s+="<tbody>";for(var o=0;o<6;o++){s+="<tr>",this.showWeekNumbers&&(s+='<td class="week">'+t[o][0].getWeek()+"</td>");for(var u=0;u<7;u++){var a="available ";a+=t[o][u].getMonth()==t[1][1].getMonth()?"":"off",n.setHours(0,0,0,0),r&&t[o][u]<r||i&&t[o][u]>i?a=" off disabled ":t[o][u].is(n)?(a+=" active ",t[o][u].is(this.startDate)&&(a+=" start-date "),t[o][u].is(this.endDate)&&(a+=" end-date ")):t[o][u]>=this.startDate&&t[o][u]<=this.endDate&&(a+=" in-range ",t[o][u].is(this.startDate)&&(a+=" start-date "),t[o][u].is(this.endDate)&&(a+=" end-date "));var f="r"+o+"c"+u;s+='<td class="'+a.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" title="'+f+'">'+t[o][u].getDate()+"</td>"}s+="</tr>"}return s+="</tbody>",s+="</table>",s},getDaysInMonth:function(e,t){return/8|3|5|10/.test(--t)?30:t==1?!(e%4)&&e%100||!(e%400)?29:28:31}},e.fn.daterangepicker=function(n,r){return this.each(function(){var i=e(this);i.data("daterangepicker")||i.data("daterangepicker",new t(i,n,r))}),this}}(window.jQuery);