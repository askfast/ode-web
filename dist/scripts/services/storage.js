define(["services/services","config"],function(e,t){e.factory("Storage",function(e){t.title.substr(-1)!=="."&&(t.title=t.title?t.title+".":"");var n=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return!1}},r=function(e,r){if(!n())return!1;if(!r&&r!==0&&r!=="")return!1;try{localStorage.setItem(t.title+e,r)}catch(i){return!1}return!0},i=function(e){if(!n())return!1;var r=localStorage.getItem(t.title+e);return r?r:null},s=function(e){if(!n())return!1;try{localStorage.removeItem(t.title+e)}catch(r){return!1}return!0},o=function(){if(!n())return!1;var e=t.title.length;for(var r in localStorage)if(r.substr(0,e)===t.title)try{s(r.substr(e))}catch(i){return!1}return!0},u=function(){try{return"sessionStorage"in window&&window.sessionStorage!==null}catch(e){return!1}},a=function(e,n){if(!u())return!1;if(!n&&n!==0&&n!=="")return!1;try{sessionStorage.setItem(t.title+e,n)}catch(r){return!1}return!0},f=function(e){if(!u())return!1;var n=sessionStorage.getItem(t.title+e);return n?n:null},l=function(e){if(!u())return!1;try{sessionStorage.removeItem(t.title+e)}catch(n){return!1}return!0},c=function(){if(!u())return!1;var e=t.title.length;for(var n in sessionStorage)if(n.substr(0,e)===t.title)try{l(n.substr(e))}catch(r){return!1}return!0},h=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(e){return!1}},p=function(e,n){if(typeof n=="undefined")return!1;if(!h())return!1;try{var r="",i=new Date;n===null&&(t.cookie.expiry=-1,n=""),t.cookie.expiry!==0&&(i.setTime(i.getTime()+t.cookie.expiry*60*60*1e3),r="; expires="+i.toGMTString()),document.cookie=t.title+e+"="+n+r+"; path="+t.cookie.path}catch(s){return!1}return!0},d=function(n){if(!h())return e.$broadcast("StorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;var r=document.cookie.split(";");for(var i=0;i<r.length;i++){var s=r[i];while(s.charAt(0)==" ")s=s.substring(1,s.length);if(s.indexOf(t.title+n+"=")==0)return decodeURIComponent(s.substring(t.title.length+n.length+1,s.length))}return null},v=function(e){p(e,null)},m=function(){var e=null,n=null,r=t.title.length,i=document.cookie.split(";");for(var s=0;s<i.length;s++){e=i[s];while(e.charAt(0)==" ")e=e.substring(1,e.length);key=e.substring(r,e.indexOf("=")),v(key)}},g=function(e){var t=e?localStorage.key:localStorage;return((3+t.length*16/8192)*.0009765625).toPrecision(2)+" MB"},y=function(){return angular.fromJson(i("periods"))},b=function(){return angular.fromJson(i("groups"))},w=function(){return angular.fromJson(i("members"))},E=function(){var t=angular.fromJson(i("resources"));return t.settingsWebPaige?angular.fromJson(t.settingsWebPaige):e.StandBy.config.defaults.settingsWebPaige};return{isSupported:n,add:r,get:i,remove:s,clearAll:o,session:{add:a,get:f,remove:l,clearAll:c},cookie:{add:p,get:d,remove:v,clearAll:m},size:g,local:{periods:y,groups:b,members:w,settings:E}}})});