define(["controllers/controllers","config"],function(e,t){e.controller("tv",["$scope","$rootScope","$q","$window","$location","Dashboard","Dater","Settings","Profile","Groups","Announcer","Store","$http",function(e,t,n,r,i,s,o,u,a,f,l,c,h){function d(t){var n=c("smartAlarm").get("guard");e.saMembers={truck:[],reserves:[]},e.saSynced=n.synced,_.each(t.selection,function(n){function r(e){return e!==null?t.users[e].name:"Niet ingedeeld"}var i=n.user==null?"sa-icon-not-assigned":null;switch(n.role){case"bevelvoerder":e.saMembers.truck.push({rank:1,icon:"B",role:"Bevelvoerder","class":n.user==null?"sa-icon-not-assigned":"sa-icon-commander",name:r(n.user)});break;case"chauffeur":e.saMembers.truck.push({rank:0,icon:"C",role:"Chauffeur","class":n.user==null?"sa-icon-not-assigned":"sa-icon-driver",name:r(n.user)});break;case"manschap.1":e.saMembers.truck.push({rank:2,icon:"M1",role:"Manschap 1",name:r(n.user),"class":i});break;case"manschap.2":e.saMembers.truck.push({rank:3,icon:"M2",role:"Manschap 2",name:r(n.user),"class":i});break;case"manschap.3":e.saMembers.truck.push({rank:4,icon:"M3",role:"Manschap 3",name:r(n.user),"class":i});break;case"manschap.4":e.saMembers.truck.push({rank:5,icon:"M4",role:"Manschap 4",name:r(n.user),"class":i})}var s={},o=["available","unavailable","noplanning"];_.each(o,function(e){s[e]=[],_.each(t.reserves[e],function(t){_.each(t,function(t,n){s[e].push({id:n,name:t.name,state:t.state})})})}),e.saMembers.reserves=s,e.loading.smartAlarm=!1})}t.notifier.destroy();if(!h.defaults.headers.common["X-SESSION_ID"]){var p=c("session").get("sessionId");h.defaults.headers.common["X-SESSION_ID"]=p.id}t.fixStyles(),$(".navbar").hide(),$("#footer").hide(),$("#watermark").css({bottom:"-10px"}),e.loading={alerts:!0,smartAlarm:!0},e.synced={alarms:(new Date).getTime()},f.query().then(function(t){var r=[];_.each(t,function(e){r.push(f.get(e.uuid))}),n.all(r).then(function(){f.uniqueMembers();var t=c("smartAlarm").get("guard");t&&t.selection&&(e.loading.smartAlarm=!1,d(c("smartAlarm").get("guard"))),f.guardMonitor().then(function(){f.guardRole().then(function(e){d(e)})})})}),e.getP2000=function(){s.p2000().then(function(t){e.loading.alerts=!1,e.alarms=t.alarms,e.alarms.list=e.alarms.short,e.synced.alarms=t.synced})},r.setInterval(function(){e.$apply(),e.getP2000();var t=c("smartAlarm").get("guard");t&&t.selection&&d(c("smartAlarm").get("guard")),f.guardRole().then(function(e){d(e)})},t.StandBy.config.timers.TV_SYNC),$.ajax({url:t.StandBy.config.profile.p2000.url,dataType:"json",success:function(n){t.statusBar.off();var r=l.process(n,!0),i={alarms:r,synced:(new Date).getTime()};e.$apply(function(){e.loading.alerts=!1,e.alarms=i.alarms,e.alarms.list=e.alarms.short,e.synced.alarms=i.synced})},error:function(){console.log("ERROR with getting p2000 for the first time!")}})}])});