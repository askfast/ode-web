define(["services/services","config"],function(e,t){e.factory("Dashboard",["$rootScope","$resource","$q","Slots","Dater","Announcer","Store",function(e,n,r,i,s,o,u){var a=n("http://knrm.myask.me/rpc/client/p2000.php",{},{p2000:{method:"GET",params:{},isArray:!0}}),f=n(t.host+"/capcodes",{},{capcodes:{method:"GET",params:{},isArray:!0}});return a.prototype.pies=function(){var t=r.defer(),n=u("network").get("groups"),s=angular.fromJson(u("user").get("resources").settingsWebPaige).app.widgets.groups,o=[];return s.length===0&&console.warn("no settings"),angular.forEach(n,function(t){s[t.uuid]&&s[t.uuid].status&&(e.StandBy.environment.divisions.length==0?o.push(i.pie({id:t.uuid,name:t.name,division:"both"})):s[t.uuid].divisions?_.each(e.StandBy.config.timeline.config.divisions,function(e){e.id!=="all"&&o.push(i.pie({id:t.uuid,name:t.name,division:e.id}))}):o.push(i.pie({id:t.uuid,name:t.name,division:"both"})))}),r.all(o).then(function(n){e.statusBar.off(),t.resolve(n)}),t.promise},a.prototype.getCapcodes=function(){function t(e){var t="";return angular.forEach(e,function(e){t+=e}),String(t)}var e=r.defer();return f.capcodes(null,function(n){var r=[];angular.forEach(n,function(e){r.push(t(e))}),e.resolve(r)},function(t){e.resolve({error:t})}),e.promise},a.prototype.p2000=function(){var n=r.defer();return e.statusBar.display(e.ui.dashboard.gettingAlarms),e.StandBy.config.profile.smartAlarm?$.ajax({url:e.StandBy.config.profile.p2000.url,dataType:"json",success:function(t){e.statusBar.off();var r=o.process(t,!0);n.resolve({alarms:r,synced:(new Date).getTime()})},error:function(){n.resolve({error:error})}}):a.prototype.getCapcodes().then(function(r){$.ajax({url:t.profile.p2000.url+"?code="+r,dataType:"jsonp",success:function(t){e.statusBar.off();var r=o.process(t);n.resolve({alarms:r,synced:(new Date).getTime()})},error:function(){n.resolve({error:error})}})}),n.promise},new a}])});